<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BenQ Materials 工安防護具挑戰</title>
    
    <style>
        body { 
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; 
            margin: 0; 
            padding: 0; 
            background-color: #f3f0f9;
            overscroll-behavior: none;
            overflow: hidden;
        }

        /* --- 活潑的載入畫面 --- */
        .loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: #ffffff; z-index: 9999;
        }
        .loading-blob {
            width: 60px; height: 60px;
            background: #652d90;
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            animation: blob-pulse 1.5s infinite ease-in-out;
        }
        @keyframes blob-pulse {
            0% { transform: scale(1); border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; }
            50% { transform: scale(1.1); border-radius: 60% 40% 30% 70% / 60% 50% 40% 50%; }
            100% { transform: scale(1); border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; }
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(101, 45, 144, 0.3); border-radius: 10px; }

        /* --- 有機流體背景 --- */
        .organic-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
            background: linear-gradient(180deg, #f3f0f9 0%, #e9dff5 100%);
            overflow: hidden;
        }
        .blob {
            position: absolute;
            background: linear-gradient(45deg, #652d90, #9d4edd);
            opacity: 0.1;
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            animation: float 20s infinite linear;
        }
        .blob:nth-child(1) { width: 80vw; height: 80vw; top: -40%; left: -20%; animation-duration: 25s; opacity: 0.08; }
        .blob:nth-child(2) { width: 60vw; height: 60vw; bottom: -20%; right: -20%; animation-duration: 30s; animation-direction: reverse; opacity: 0.1; }
        
        @keyframes float {
            0% { transform: rotate(0deg) translate(0, 0); }
            50% { transform: rotate(180deg) translate(20px, 20px); }
            100% { transform: rotate(360deg) translate(0, 0); }
        }

        /* --- 玻璃擬態與 Q 彈效果 --- */
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 10px 40px -10px rgba(101, 45, 144, 0.15);
        }
        
        .btn-jelly:active {
            animation: jelly 0.5s;
        }
        @keyframes jelly {
            0%, 100% { transform: scale(1, 1); }
            25% { transform: scale(0.9, 1.1); }
            50% { transform: scale(1.1, 0.9); }
            75% { transform: scale(0.95, 1.05); }
        }

        /* LOGO 豆子形狀容器 (CSS Fallback) */
        .benq-bean-shape {
            background: #652d90;
            border-radius: 48% 52% 68% 32% / 42% 58% 42% 58%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 900;
            font-family: Arial, sans-serif;
            letter-spacing: -1px;
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.2), inset 5px 5px 15px rgba(255,255,255,0.2);
            /* 讓它看起來更有立體感 */
            background: radial-gradient(circle at 30% 30%, #7c4bb5, #652d90);
        }
    </style>

    <script>
        function handleScriptError(e) {
            alert("⚠️ 網路資源載入失敗！請檢查網路連線。");
        }
    </script>
    
    <script src="https://cdn.tailwindcss.com" onerror="handleScriptError(this)"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js" onerror="handleScriptError(this)"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" onerror="handleScriptError(this)"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" onerror="handleScriptError(this)"></script>

    <script>
        window.onload = function() {
            if (typeof tailwind !== 'undefined') {
                tailwind.config = {
                    theme: {
                        extend: {
                            colors: {
                                benq: {
                                    DEFAULT: '#652d90', // BenQ Purple
                                    hover: '#502379',
                                    light: '#8e56b8',
                                    bg: '#f3f0f9',
                                }
                            },
                            animation: {
                                'float-slow': 'float 6s ease-in-out infinite',
                                'bounce-sm': 'bounce 2s infinite',
                                'fade-in-up': 'fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1)',
                            },
                            keyframes: {
                                fadeInUp: {
                                    'from': { opacity: '0', transform: 'translateY(20px)' },
                                    'to': { opacity: '1', transform: 'translateY(0)' },
                                }
                            }
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="h-[100dvh] flex flex-col">
    
    <div id="root" class="h-full flex flex-col">
        <div class="loading-screen">
            <div class="loading-blob mb-4"></div>
            <h2 class="text-benq text-xl font-bold tracking-widest">LOADING...</h2>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icon Components ---
        const IconBase = ({ size = 24, className = "", children, ...props }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>);
        const CheckCircle = (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></IconBase>;
        const RotateCcw = (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></IconBase>;
        const ArrowRight = (p) => <IconBase {...p}><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></IconBase>;
        const History = (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path><path d="M12 7v5l4 2"></path></IconBase>;
        const UserCheck = (p) => <IconBase {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><polyline points="16 11 18 13 22 9"></polyline></IconBase>;
        const Upload = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></IconBase>;
        const User = (p) => <IconBase {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>;
        const Briefcase = (p) => <IconBase {...p}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></IconBase>;
        const MapPin = (p) => <IconBase {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconBase>;
        const Lightbulb = (p) => <IconBase {...p}><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5A6 6 0 0 0 6 8c0 1 .5 2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"></path><path d="M9 18h6"></path><path d="M10 22h4"></path></IconBase>;
        const AlertTriangle = (p) => <IconBase {...p}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></IconBase>;
        const Star = (p) => <IconBase {...p}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></IconBase>;

        // --- Custom PPE Icons (SVG) ---
        const IconHelmet = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 36c0-14 10-26 28-26s28 12 28 26v4H4v-4z" fill="#FBBF24" stroke="#D97706" /><path d="M32 10v4M4 36h56M12 36c0-4 2-8 6-8h28c4 0 6 4 6 8" stroke="#D97706" strokeLinecap="round"/><path d="M28 14h8" stroke="#D97706" strokeWidth="3"/></svg>;
        const IconGoggles = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M12 28c0-6 4-10 10-10h6c2 0 4 2 4 4s2 4 4 4 4-2 4-4 2-4 4-4h6c6 0 10 4 10 10v6c0 6-4 10-10 10h-6c-2 0-4-2-4-4s-2-4-4-4-4 2-4 4-2 4-4 4h-6c-6 0-10-4-10-10v-6z" fill="#BFDBFE" stroke="#2563EB" strokeWidth="3"/><path d="M4 30h8M52 30h8" stroke="#1F2937" strokeWidth="3" strokeLinecap="round"/></svg>;
        const IconWeldingMask = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><rect x="14" y="8" width="36" height="48" rx="8" fill="#1F2937" stroke="#000" strokeWidth="2"/><rect x="20" y="20" width="24" height="12" rx="2" fill="#111827" stroke="#F59E0B" strokeWidth="2"/><path d="M22 26h20" stroke="#F59E0B" strokeWidth="1" opacity="0.5"/></svg>;
        const IconFaceShield = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M16 12h32v4H16z" fill="#374151" stroke="#000" strokeWidth="2"/><path d="M16 16v32c0 8 8 12 16 12s16-4 16-12V16H16z" fill="#A7F3D0" stroke="#059669" strokeWidth="2" fillOpacity="0.6"/><path d="M24 24l16 16" stroke="#059669" strokeWidth="1" opacity="0.5"/></svg>;
        const IconEarmuffs = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M12 18a4 4 0 0 1 4-4h32a4 4 0 0 1 4 4v20" stroke="#374151" strokeWidth="3" strokeLinecap="round"/><rect x="6" y="24" width="12" height="24" rx="6" fill="#F97316" stroke="#C2410C" strokeWidth="2"/><rect x="46" y="24" width="12" height="24" rx="6" fill="#F97316" stroke="#C2410C" strokeWidth="2"/><path d="M10 30h4M50 30h4" stroke="#FFF" strokeOpacity="0.5"/></svg>;
        const IconGasMask = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M16 16h32v24c0 10-8 16-16 16s-16-6-16-16V16z" fill="#374151" stroke="#111827" strokeWidth="2"/><circle cx="22" cy="28" r="6" fill="#111827" stroke="#6B7280" strokeWidth="2"/><circle cx="42" cy="28" r="6" fill="#111827" stroke="#6B7280" strokeWidth="2"/><rect x="26" y="40" width="12" height="12" rx="2" fill="#4B5563" stroke="#9CA3AF" strokeWidth="2"/></svg>;
        const IconN95 = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M14 20c0-2 18-6 18-6s18 4 18 6c0 10-4 26-18 26s-18-16-18-26z" fill="#F9FAFB" stroke="#9CA3AF" strokeWidth="2"/><path d="M8 24h6M50 24h6" stroke="#FCA5A5" strokeWidth="2"/><circle cx="24" cy="28" r="2" fill="#D1D5DB"/></svg>;
        const IconHarness = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M16 8v48M48 8v48" stroke="#EF4444" strokeWidth="4"/><path d="M16 20h32M16 40h32" stroke="#EF4444" strokeWidth="4"/><path d="M16 12l32 40M48 12L16 52" stroke="#B91C1C" strokeWidth="3"/></svg>;
        const IconVest = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M12 12h12l8 16 8-16h12v40H12V12z" fill="#A3E635" stroke="#4D7C0F" strokeWidth="2"/><path d="M12 36h40M12 44h40" stroke="#E5E7EB" strokeWidth="4"/><path d="M22 12v40M42 12v40" stroke="#E5E7EB" strokeWidth="4"/></svg>;
        const IconApron = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M22 8h20v8H22z" stroke="#1D4ED8" strokeWidth="2"/><path d="M18 16h28l4 8v32H14V24l4-8z" fill="#2563EB" stroke="#1E40AF" strokeWidth="2"/><path d="M24 30h16" stroke="#60A5FA" strokeWidth="2" opacity="0.5"/></svg>;
        const IconGlove = ({ color, type }) => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M20 54V30a4 4 0 0 1 8 0v-4a4 4 0 0 1 8 0v-2a4 4 0 0 1 8 0v4a4 4 0 0 1 8 0v26H20z" fill={color} stroke="#4B5563" strokeWidth="2"/><path d="M20 50h32" stroke="#000" strokeOpacity="0.1"/>{type === 'dot' && <circle cx="32" cy="40" r="1" fill="#000" opacity="0.2"/>}{type === 'line' && <path d="M28 36v10" stroke="#000" opacity="0.1"/>}</svg>;
        const IconBoot = ({ color, sole }) => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M18 12h16v24h14c4 0 6 4 6 8v8H14V16c0-2 2-4 4-4z" fill={color} stroke="#1F2937" strokeWidth="2"/><path d="M14 52h40v4H14z" fill={sole} stroke="#000" strokeWidth="1"/><path d="M18 16h16" stroke="#FFF" strokeOpacity="0.2"/></svg>;

        const EQUIPMENT_LIST = [
          { id: 'helmet', name: '工業安全帽', Component: IconHelmet, category: 'head', color: 'bg-yellow-400' },
          { id: 'goggles', name: '安全護目鏡', Component: IconGoggles, category: 'eyes', color: 'bg-blue-200' },
          { id: 'mask_welding', name: '焊接面罩', Component: IconWeldingMask, category: 'eyes', color: 'bg-gray-800' },
          { id: 'shield_face', name: '防護面罩', Component: IconFaceShield, category: 'eyes', color: 'bg-emerald-200' },
          { id: 'earmuffs', name: '防音耳罩', Component: IconEarmuffs, category: 'ears', color: 'bg-orange-400' },
          { id: 'mask_gas', name: '防毒面具', Component: IconGasMask, category: 'face', color: 'bg-gray-700' },
          { id: 'mask_dust', name: 'N95口罩', Component: IconN95, category: 'face', color: 'bg-white' },
          { id: 'harness', name: '高空安全帶', Component: IconHarness, category: 'body_acc', color: 'bg-red-500' },
          { id: 'vest', name: '反光背心', Component: IconVest, category: 'body', color: 'bg-lime-400' },
          { id: 'apron', name: '防護圍裙', Component: IconApron, category: 'body_outer', color: 'bg-blue-700' },
          { id: 'gloves_cotton', name: '棉紗手套', Component: () => <IconGlove color="#E5E7EB" type="dot"/>, category: 'hands', color: 'bg-gray-200' },
          { id: 'gloves_rubber', name: '耐化學手套', Component: () => <IconGlove color="#A855F7" type="line"/>, category: 'hands', color: 'bg-purple-500' },
          { id: 'gloves_insulation', name: '絕緣手套', Component: () => <IconGlove color="#EA580C" />, category: 'hands', color: 'bg-orange-600' },
          { id: 'gloves_cut', name: '防切割手套', Component: () => <IconGlove color="#94A3B8" type="line"/>, category: 'hands', color: 'bg-slate-400' },
          { id: 'gloves_leather', name: '皮革手套', Component: () => <IconGlove color="#B45309" />, category: 'hands', color: 'bg-amber-700' },
          { id: 'safety_shoes', name: '鋼頭安全鞋', Component: () => <IconBoot color="#1F2937" sole="#000"/>, category: 'feet', color: 'bg-slate-800' },
          { id: 'boots_rubber', name: '防護雨鞋', Component: () => <IconBoot color="#CA8A04" sole="#854D0E"/>, category: 'feet', color: 'bg-yellow-600' },
        ];

        const SCENARIOS = [
          { id: 1, title: '高空鷹架作業', description: '在 5 公尺高的鷹架上維護外牆，上方偶爾有落石。', required: ['helmet', 'harness', 'safety_shoes'], hint: '【墜落危害】高處作業須配戴安全帶，並保護頭部與腳部。' },
          { id: 2, title: '調膠室溶劑調配', description: '室內充滿有機溶劑氣味，液體具腐蝕性且容易噴濺。', required: ['mask_gas', 'goggles', 'gloves_rubber', 'apron'], hint: '【化學危害】需防止吸入毒氣，並保護眼、身、手不被腐蝕。' },
          { id: 3, title: '發電機房巡檢', description: '機房內發電機運轉中，噪音高達 95 分貝。', required: ['earmuffs', 'safety_shoes', 'helmet'], hint: '【噪音危害】保護聽力是首要任務，同時注意頭部與腳部安全。' },
          { id: 4, title: '手持砂輪機研磨', description: '研磨金屬零件，有大量火花與金屬粉塵飛散。', required: ['goggles', 'mask_dust', 'gloves_cotton', 'earmuffs'], hint: '【粉塵/火花】防護眼、肺、手，且研磨噪音大需戴耳罩。' },
          { id: 5, title: '夜間道路搶修', description: '夜間在車流量大的馬路進行坑洞修補。', required: ['helmet', 'vest', 'safety_shoes'], hint: '【被撞危害】最重要的是高可視度反光背心。' },
          { id: 6, title: '配電盤活線作業', description: '檢修 220V 未斷電的配電盤設備。', required: ['helmet', 'gloves_insulation', 'safety_shoes', 'shield_face'], hint: '【感電危害】絕緣手套與面罩防止電弧灼傷是關鍵。' },
          { id: 7, title: '鋼構電銲作業', description: '焊接鋼材，產生強烈紫外線強光、高溫與金屬噴濺。', required: ['mask_welding', 'gloves_leather', 'apron', 'safety_shoes'], hint: '【光害/高溫】需焊接面罩擋強光，皮革手套與圍裙防高溫噴濺。' },
          { id: 8, title: '割草機除草', description: '使用背負式割草機，地面碎石容易飛濺。', required: ['shield_face', 'boots_rubber', 'apron', 'gloves_cotton'], hint: '【飛落物危害】碎石易傷臉與腿，需面罩與長筒雨鞋/圍裙。' },
          { id: 9, title: '廢棄玻璃清理', description: '清理含有大量碎玻璃與尖銳鐵片的廢棄物。', required: ['gloves_cut', 'safety_shoes', 'helmet'], hint: '【切割危害】首重手部防切割與足部防穿刺。' },
          { id: 10, title: '強酸地板清洗', description: '地面積水且使用強酸清潔劑，極度濕滑。', required: ['boots_rubber', 'gloves_rubber', 'goggles', 'mask_gas'], hint: '【化學/跌倒】需防滑防水雨鞋，與完整的抗酸防護。' },
          { id: 11, title: '鑽床/車床操作', description: '操作高速旋轉的機具進行金屬鑽孔與加工。', required: ['goggles', 'safety_shoes'], forbidden: ['hands'], hint: '【捲夾危害】旋轉機具「絕對禁止」戴手套，以免被捲入！' },
          { id: 12, title: '高溫熔煉爐作業', description: '在鑄造廠高溫熔爐旁作業，有熱輻射與金屬液噴濺風險。', required: ['helmet', 'shield_face', 'gloves_leather', 'apron', 'safety_shoes'], hint: '【高溫危害】全身需耐高溫防護：皮革手套、圍裙、面罩。' },
          { id: 13, title: '破碎機打石作業', description: '使用大型氣動破碎機拆除混泥土，噪音極大且粉塵多。', required: ['earmuffs', 'mask_dust', 'goggles', 'helmet', 'safety_shoes', 'gloves_cotton'], hint: '【噪音/粉塵】高分貝噪音需耳罩，並防護粉塵與飛石。' },
          { id: 14, title: '輸送帶維修 (運轉中)', description: '在運轉中的輸送帶旁進行目視檢查 (不可接觸)。', required: ['helmet', 'safety_shoes', 'goggles'], forbidden: ['hands'], hint: '【捲夾危害】靠近運轉中機械，嚴禁戴手套或寬鬆衣物以免捲入。' },
          { id: 15, title: '化學槽車卸料 (酸液)', description: '連接管線卸收高腐蝕性酸液，接口處可能噴濺。', required: ['shield_face', 'mask_gas', 'apron', 'gloves_rubber', 'boots_rubber'], hint: '【噴濺危害】最高規格化學防護：面罩+防毒+橡膠手套+圍裙+雨鞋。' },
          { id: 16, title: '堆高機駕駛', description: '駕駛堆高機在倉庫間搬運貨物，需注意頭頂貨物與周遭人員。', required: ['helmet', 'vest', 'safety_shoes'], hint: '【被撞/物體飛落】駕駛需戴安全帽防護落物，穿背心提升能見度。' },
          { id: 17, title: '金屬切割操作', description: '使用切割機進行金屬切斷，有鐵屑飛濺與極大噪音。', required: ['helmet', 'earmuffs', 'shield_face', 'gloves_cut', 'safety_shoes'], hint: '【切割/噪音】需防切割手套、面罩擋鐵屑，以及耳罩防噪音。' },
          { id: 18, title: '粉塵作業', description: '粒子添加作業，空氣中懸浮大量細微粉塵。', required: ['mask_dust', 'goggles', 'helmet', 'safety_shoes'], hint: '【粉塵危害】高濃度粉塵環境，N95等級以上口罩與護目鏡是必須的。' },
          { id: 19, title: '液態氮分裝操作', description: '分裝零下 196 度液態氮，極低溫液體可能噴濺。', required: ['shield_face', 'gloves_leather', 'apron', 'safety_shoes'], hint: '【低溫危害】防止凍傷與噴濺，需面罩與厚絕緣手套（如皮革）。' },
          { id: 20, title: '局限空間氣體偵測', description: '進入通風不良的地下道前，需先確認氣體狀況。', required: ['helmet', 'mask_gas', 'safety_shoes', 'harness'], hint: '【缺氧/中毒】雖是偵測，但需預設有危害：佩戴呼吸防護與救援用安全帶。' }
        ];

        const TOTAL_ROUNDS = 10;

        function SafetyGearGame() {
          const [currentScenario, setCurrentScenario] = useState(null);
          const [wornItems, setWornItems] = useState([]);
          const [gameState, setGameState] = useState('start'); 
          const [message, setMessage] = useState('');
          const [failDetails, setFailDetails] = useState(null);
          const [score, setScore] = useState(0);
          const [hintVisible, setHintVisible] = useState(false);
          const [totalSeconds, setTotalSeconds] = useState(0);
          const [isActive, setIsActive] = useState(false);
          
          const [round, setRound] = useState(1);
          const [usedScenarioIds, setUsedScenarioIds] = useState([]);
          const [factoryCode, setFactoryCode] = useState('');
          const [deptCode, setDeptCode] = useState('');
          const [employeeId, setEmployeeId] = useState('');
          const [userName, setUserName] = useState('');
          const [isBlinking, setIsBlinking] = useState(false);

          useEffect(() => {
            let interval = null;
            if (isActive) {
              interval = setInterval(() => {
                setTotalSeconds(s => s + 1);
              }, 1000);
            }
            return () => clearInterval(interval);
          }, [isActive]);

          useEffect(() => {
            const blinkInterval = setInterval(() => {
              setIsBlinking(true);
              setTimeout(() => setIsBlinking(false), 200);
            }, 4000);
            return () => clearInterval(blinkInterval);
          }, []);

          const startGame = () => {
            setScore(0);
            setTotalSeconds(0);
            setRound(1);
            setUsedScenarioIds([]);
            pickNextLevel([]);
          };

          const pickNextLevel = (currentUsedIds) => {
            const availableScenarios = SCENARIOS.filter(s => !currentUsedIds.includes(s.id));
            if (availableScenarios.length === 0) {
              setGameState('result');
              setIsActive(false);
              return;
            }
            const randomIndex = Math.floor(Math.random() * availableScenarios.length);
            const nextScenario = availableScenarios[randomIndex];
            setCurrentScenario(nextScenario);
            setUsedScenarioIds([...currentUsedIds, nextScenario.id]);
            setWornItems([]);
            setGameState('playing');
            setMessage('');
            setFailDetails(null);
            setHintVisible(false);
            setIsActive(true); 
          };

          const nextRound = () => {
            if (round >= TOTAL_ROUNDS) {
              setGameState('result');
              setIsActive(false); 
            } else {
              setRound(r => r + 1);
              pickNextLevel(usedScenarioIds);
            }
          };

          const toggleItem = (item) => {
            if (gameState !== 'playing') return;
            setWornItems(prev => {
              const isWorn = prev.find(i => i.id === item.id);
              if (isWorn) {
                return prev.filter(i => i.id !== item.id);
              } else {
                let newItems = prev.filter(i => i.category !== item.category);
                return [...newItems, item];
              }
            });
          };

          const showHint = () => {
            if (!hintVisible && gameState === 'playing') {
              setHintVisible(true);
              setScore(s => Math.max(0, s - 20));
            }
          };

          const checkAnswer = () => {
            if (!currentScenario) return;
            setIsActive(false); 

            const requiredIds = currentScenario.required.sort();
            const wornIds = wornItems.map(i => i.id);
            const missingItems = requiredIds.filter(id => !wornIds.includes(id));
            const extraItems = wornIds.filter(id => !requiredIds.includes(id));
            const requiredNames = requiredIds.map(id => EQUIPMENT_LIST.find(i => i.id === id)?.name);
            const missingNames = missingItems.map(id => EQUIPMENT_LIST.find(i => i.id === id)?.name);

            const isEntanglementHazard = currentScenario.forbidden && currentScenario.forbidden.includes('hands');
            const hasGloves = wornItems.some(i => i.category === 'hands');
            
            let isSuccess = false;
            let failMsg = '';

            if (isEntanglementHazard && hasGloves) {
                isSuccess = false;
                failMsg = '捲夾危害：旋轉機具嚴禁戴手套！';
                setFailDetails({ type: 'forbidden', text: '旋轉機具禁止戴手套，因為會被捲入機械中造成嚴重傷害。', correctList: requiredNames });
            } else if (missingItems.length === 0 && extraItems.length === 0) {
                isSuccess = true;
            } else {
                isSuccess = false;
                failMsg = '防護不完整或錯誤！';
                setFailDetails({ type: 'incorrect', missing: missingNames, correctList: requiredNames });
            }

            if (isSuccess) {
              setGameState('success');
              setScore(s => s + 100);
              setMessage(`完美防護！`);
            } else {
              setGameState('failure');
              setMessage(failMsg);
            }
          };

          const WorkerFigure = ({ className = "" }) => {
            const getItemByCat = (cat) => wornItems.find(i => i.category === cat);
            const head = getItemByCat('head');
            const eyes = getItemByCat('eyes'); 
            const face = getItemByCat('face');
            const ears = getItemByCat('ears');
            const body = getItemByCat('body');
            const bodyAcc = getItemByCat('body_acc');
            const bodyOuter = getItemByCat('body_outer');
            const hands = getItemByCat('hands');
            const feet = getItemByCat('feet');

            const breatheClass = gameState === 'playing' ? '' : ''; 
            const successClass = gameState === 'success' ? '' : ''; 
            const failClass = gameState === 'failure' ? '' : ''; 

            return (
              <div className={`relative w-full h-full flex flex-col items-center justify-end shrink-0 transition-all`}>
                
                {/* 阿基獅縮放與位置調整 */}
                <div className={`relative flex flex-col items-center transform transition-transform duration-500 origin-bottom z-10 ${className} ${successClass} ${failClass}`}>
                  
                  {/* 阿基獅頭部 (更新版) */}
                  <div className={`relative z-30 flex flex-col items-center w-40 h-40 -mb-4 ${breatheClass}`}>
                    
                    {/* 鬃毛 (最底層) - 棕色圓形 */}
                    <div className="absolute top-0 left-0 w-full h-full z-0 scale-110">
                       <svg viewBox="0 0 100 100" className="w-full h-full overflow-visible">
                          <circle cx="50" cy="50" r="48" fill="#C27803" stroke="#92400E" strokeWidth="2" />
                       </svg>
                    </div>

                    {ears && (
                      <div className="absolute top-8 w-full flex justify-between px-2 z-20 pointer-events-none">
                         <div className={`w-5 h-10 ${ears.color} rounded-lg border-2 border-gray-700 shadow-sm -ml-4`}></div>
                         <div className={`w-5 h-10 ${ears.color} rounded-lg border-2 border-gray-700 shadow-sm -mr-4`}></div>
                         <div className="absolute -top-4 left-1/2 -translate-x-1/2 w-44 h-12 border-t-4 border-gray-700 rounded-full"></div>
                      </div>
                    )}

                    <div className="relative w-28 h-32 z-10 top-2">
                       <svg viewBox="0 0 100 120" className="w-full h-full overflow-visible">
                          {/* 耳朵 */}
                          <circle cx="20" cy="10" r="12" fill="#FCD34D" stroke="#C27803" strokeWidth="2" />
                          <circle cx="20" cy="10" r="6" fill="#C27803" opacity="0.6" />
                          <circle cx="80" cy="10" r="12" fill="#FCD34D" stroke="#C27803" strokeWidth="2" />
                          <circle cx="80" cy="10" r="6" fill="#C27803" opacity="0.6" />

                          {/* 臉型 (倒蛋形) */}
                          <path d="M 15 40 Q 15 5 50 5 Q 85 5 85 40 L 85 70 Q 85 105 50 105 Q 15 105 15 70 Z" fill="#FCD34D" stroke="#C27803" strokeWidth="2" />
                          
                          {/* 眼睛 (笑眼 - 倒U) */}
                          <path d="M 30 45 Q 38 35 46 45" stroke="#1F2937" strokeWidth="4" fill="none" strokeLinecap="round" />
                          <path d="M 54 45 Q 62 35 70 45" stroke="#1F2937" strokeWidth="4" fill="none" strokeLinecap="round" />

                          {/* 吻部線條 */}
                          <path d="M 20 60 Q 50 55 80 60" stroke="#C27803" strokeWidth="1" fill="none" opacity="0.3" />

                          {/* 鼻子 (大黑鼻 + 高光) */}
                          <path d="M 35 60 Q 50 50 65 60 Q 70 70 50 75 Q 30 70 35 60" fill="#000" />
                          <ellipse cx="45" cy="58" rx="6" ry="3" fill="white" opacity="0.9" transform="rotate(-15 45 58)"/>
                          <path d="M 50 75 L 50 85" stroke="#000" strokeWidth="1.5" />

                          {/* 嘴巴 (大笑 - 開口) */}
                          <path d="M 30 85 Q 50 105 70 85 Q 50 85 30 85" fill="#7F1D1D" />
                          <path d="M 40 95 Q 50 90 60 95" fill="#F472B6" /> 
                       </svg>

                       {/* 裝備層 */}
                       {eyes && (
                         <div className="absolute top-8 left-1/2 -translate-x-1/2 z-50">
                            {eyes.id === 'goggles' && <div className={`w-32 h-14 ${eyes.color} opacity-80 border-4 border-gray-600 rounded-xl backdrop-blur-sm shadow-md`}></div>}
                            {eyes.id === 'mask_welding' && <div className="w-36 h-40 -mt-12 bg-gray-800 rounded-3xl border-2 border-gray-600 flex items-center justify-center shadow-lg"><div className="w-24 h-12 bg-black border-2 border-yellow-500 rounded"></div></div>}
                            {eyes.id === 'shield_face' && <div className={`w-36 h-40 -mt-10 ${eyes.color} opacity-60 border-t-4 border-gray-500 rounded-3xl backdrop-blur-sm shadow-sm`}></div>}
                         </div>
                       )}
                       {face && (
                         <div className={`absolute bottom-[-10px] left-1/2 -translate-x-1/2 w-28 h-20 ${face.color} rounded-b-[2rem] rounded-t-lg border border-gray-400 z-40 flex items-center justify-center shadow-sm`}>
                            {face.id === 'mask_gas' && <div className="flex gap-2"><div className="w-8 h-8 bg-gray-800 rounded-full border-2 border-gray-500"></div><div className="w-8 h-8 bg-gray-800 rounded-full border-2 border-gray-500"></div></div>}
                            {face.id === 'mask_dust' && <div className="w-12 h-10 bg-white rounded-full border border-gray-200 opacity-50"></div>}
                         </div>
                       )}
                       {head && (
                         <div className={`absolute -top-16 left-1/2 -translate-x-1/2 w-44 h-24 ${head.color} rounded-t-full border-b-4 border-gray-700 shadow-md z-50 flex items-center justify-center`}>
                            <div className="w-32 h-2 bg-black/10 rounded-full mt-14"></div>
                            <div className="absolute top-4 w-full text-center text-[10px] font-bold text-black/30">SAFETY FIRST</div>
                         </div>
                       )}
                    </div>
                  </div>

                  {/* 身體 (Purple) */}
                  <div className="relative z-20 -mt-2">
                    <div className={`absolute -left-8 top-6 w-10 h-32 bg-[#FCD34D] rounded-full origin-top transform rotate-12 border-2 border-[#C27803] flex flex-col justify-end items-center z-0 transition-transform ${gameState === 'success' ? '-rotate-[140deg] -translate-x-4' : ''}`}></div>
                    <div className={`absolute -right-8 top-6 w-10 h-32 bg-[#FCD34D] rounded-full origin-top transform -rotate-12 border-2 border-[#C27803] flex flex-col justify-end items-center z-0 transition-transform ${gameState === 'success' ? 'rotate-[140deg] translate-x-4' : ''}`}></div>

                    <div className="w-40 h-44 bg-purple-800 rounded-[2rem] relative z-10 border-2 border-purple-900 overflow-hidden flex items-center justify-center shadow-inner">
                       <div className="w-1 h-full bg-black/20"></div>
                       <div className="absolute top-10 left-10 opacity-40 text-white"><Building2 size={20}/></div>
                       {body && <div className={`absolute inset-0 w-full h-full ${body.color} flex flex-col items-center`}><div className="w-full h-full border-x-8 border-orange-500/50"></div></div>}
                       {bodyOuter && <div className={`absolute inset-0 top-4 mx-2 h-full ${bodyOuter.color} rounded-b-lg border-2 border-white/20 shadow-lg`}><div className="absolute -top-4 left-1/2 -translate-x-1/2 w-20 h-4 bg-inherit border-x-2 border-t-2 border-white/20"></div></div>}
                       {bodyAcc && <div className="absolute inset-0 w-full h-full pointer-events-none"><div className="absolute top-10 left-0 w-full h-3 bg-red-600 shadow-sm"></div><div className="absolute top-0 left-8 w-3 h-full bg-red-600 shadow-sm"></div><div className="absolute top-0 right-8 w-3 h-full bg-red-600 shadow-sm"></div></div>}
                    </div>

                    {hands && (
                      <>
                        <div className={`absolute -left-10 top-32 w-14 h-16 ${hands.color} rounded-xl border-2 border-gray-600 shadow-sm z-20 transform rotate-12 ${gameState === 'success' ? 'top-[-50px] -left-[90px]' : ''}`}></div>
                        <div className={`absolute -right-10 top-32 w-14 h-16 ${hands.color} rounded-xl border-2 border-gray-600 shadow-sm z-20 transform -rotate-12 ${gameState === 'success' ? 'top-[-50px] -right-[90px]' : ''}`}></div>
                      </>
                    )}
                  </div>

                  {/* 腿部 */}
                  <div className="flex gap-1 -mt-4 z-10">
                    <div className="w-16 h-32 bg-slate-800 rounded-b-lg border-2 border-slate-900 relative flex justify-center shadow-lg">
                       {feet ? <div className={`absolute -bottom-2 w-18 h-12 ${feet.color} rounded-lg border-b-4 border-black z-20`}></div> : <div className="absolute -bottom-2 w-18 h-10 bg-black rounded-lg z-20"></div>}
                    </div>
                    <div className="w-16 h-32 bg-slate-800 rounded-b-lg border-2 border-slate-900 relative flex justify-center shadow-lg">
                       {feet ? <div className={`absolute -bottom-2 w-18 h-12 ${feet.color} rounded-lg border-b-4 border-black z-20`}></div> : <div className="absolute -bottom-2 w-18 h-10 bg-black rounded-lg z-20"></div>}
                    </div>
                  </div>
                </div>

                <div className="absolute bottom-4 w-56 h-8 bg-black/20 rounded-[100%] blur-sm z-0"></div>
              </div>
            );
          };

          // --- 主畫面渲染 ---
          if (gameState === 'start' || gameState === 'result') {
            return (
              <div className="min-h-screen bg-slate-100 flex items-center justify-center p-4 relative overflow-hidden bg-gradient-animate">
                {/* Decorative Background Elements */}
                <div className="organic-bg">
                    <div className="blob"></div>
                    <div className="blob"></div>
                </div>

                <div className="w-full max-w-md glass-card rounded-3xl overflow-hidden relative z-10 animate-fade-in-up">
                    {/* Header Section */}
                    <div className="p-8 pb-0 text-center relative">
                        <div className="relative z-10">
                            {/* LOGO 區域 */}
                            <div className="flex justify-center mb-6">
                                <img 
                                    src="logo.png" 
                                    alt="BenQ Logo" 
                                    className="h-16 object-contain filter drop-shadow-lg"
                                    onError={(e) => {
                                        e.target.style.display = 'none';
                                        e.target.nextSibling.style.display = 'flex';
                                    }}
                                />
                                <div className="benq-bean-shape w-32 h-20 text-3xl hidden">BenQ</div>
                            </div>
                            
                            <h1 className="text-3xl font-black text-benq tracking-tight mb-2">BenQ Materials</h1>
                            <div className="text-slate-500 font-bold text-3xl tracking-widest uppercase mb-8">工安防護具挑戰</div>
                        </div>
                    </div>

                    {/* Form Section / Result Section */}
                    <div className="p-8 pt-0 space-y-5 relative z-10">
                        {gameState === 'result' ? (
                             <div className="w-full flex-1 overflow-hidden flex flex-col animate-slide-up">
                                <div className="bg-white/60 rounded-2xl p-5 mb-6 border border-white/50 shadow-inner flex justify-between items-center backdrop-blur-sm">
                                   <div>
                                     <div className="text-xs text-slate-400 font-bold uppercase tracking-wider mb-1">總得分</div>
                                     <div className="text-4xl font-black text-benq">{score}</div>
                                   </div>
                                   <div className="text-right">
                                     <div className="text-xs text-slate-400 font-bold uppercase tracking-wider mb-1">總耗時</div>
                                     <div className="text-3xl font-black text-orange-500 flex items-center justify-end gap-1"><History size={20}/>{totalSeconds}s</div>
                                   </div>
                                </div>

                                <div className="bg-white/80 border border-purple-100 rounded-2xl p-5 text-left mb-6 shadow-sm backdrop-blur-md">
                                    <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2 text-lg border-b border-purple-100 pb-2"><UserCheck size={20} className="text-benq"/> 挑戰者資訊</h3>
                                    <div className="space-y-3 text-sm">
                                        <div className="flex justify-between items-center p-2 bg-slate-50 rounded-lg"><span className="text-slate-500">廠區代碼</span> <span className="font-bold text-slate-800 bg-white px-2 py-1 rounded border border-slate-200">{factoryCode}</span></div>
                                        <div className="flex justify-between items-center p-2 bg-slate-50 rounded-lg"><span className="text-slate-500">部門代碼</span> <span className="font-bold text-slate-800 bg-white px-2 py-1 rounded border border-slate-200">{deptCode}</span></div>
                                        <div className="flex justify-between items-center p-2 bg-slate-50 rounded-lg"><span className="text-slate-500">工號</span> <span className="font-bold text-slate-800 bg-white px-2 py-1 rounded border border-slate-200">{employeeId}</span></div>
                                        <div className="flex justify-between items-center p-2 bg-slate-50 rounded-lg"><span className="text-slate-500">姓名</span> <span className="font-bold text-slate-800 bg-white px-2 py-1 rounded border border-slate-200">{userName}</span></div>
                                    </div>
                                </div>

                                <div className="text-center mb-6">
                                    <p className="text-benq font-bold mb-3 animate-bounce flex items-center justify-center gap-2"><Star size={16} fill="currentColor"/> 請截圖此畫面 <Star size={16} fill="currentColor"/></p>
                                    <a href="https://forms.gle/4z1WqZMZEVMeXUgMA" target="_blank" className="block w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white py-4 rounded-2xl font-bold shadow-lg shadow-green-200 transition-all active:scale-95 flex items-center justify-center gap-2 text-lg btn-jelly">
                                        <Upload size={24}/> 上傳成績截圖
                                    </a>
                                </div>
                                
                                <button onClick={() => setGameState('start')} className="w-full bg-white hover:bg-slate-50 text-slate-500 py-3 rounded-xl font-bold flex justify-center gap-2 items-center transition-colors border border-slate-200 active:scale-95"><RotateCcw size={18}/> 回首頁</button>
                             </div>
                        ) : (
                            <div className="space-y-5 animate-slide-up">
                                <div className="relative group">
                                    <div className="absolute left-4 top-4 text-slate-400 group-focus-within:text-benq transition-colors duration-300">
                                        <MapPin size={20} />
                                    </div>
                                    <input type="text" placeholder="廠區代碼" className="w-full pl-12 pr-4 py-4 rounded-2xl border-2 border-transparent bg-white/60 font-bold outline-none input-glow transition-all focus:bg-white placeholder-slate-400 shadow-sm" value={factoryCode} onChange={(e) => setFactoryCode(e.target.value)} />
                                </div>
                                <div className="relative group">
                                   <div className="absolute left-4 top-4 text-slate-400 group-focus-within:text-benq transition-colors duration-300">
                                        <Briefcase size={20} />
                                    </div>
                                    <input type="text" placeholder="部門代碼" className="w-full pl-12 pr-4 py-4 rounded-2xl border-2 border-transparent bg-white/60 font-bold outline-none input-glow transition-all focus:bg-white placeholder-slate-400 shadow-sm" value={deptCode} onChange={(e) => setDeptCode(e.target.value)} />
                                </div>
                                <div className="relative group">
                                    <div className="absolute left-4 top-4 text-slate-400 group-focus-within:text-benq transition-colors duration-300">
                                        <UserCheck size={20} />
                                    </div>
                                    <input type="text" placeholder="工號" className="w-full pl-12 pr-4 py-4 rounded-2xl border-2 border-transparent bg-white/60 font-bold outline-none input-glow transition-all focus:bg-white placeholder-slate-400 shadow-sm" value={employeeId} onChange={(e) => setEmployeeId(e.target.value)} />
                                </div>
                                <div className="relative group">
                                    <div className="absolute left-4 top-4 text-slate-400 group-focus-within:text-benq transition-colors duration-300">
                                        <User size={20} />
                                    </div>
                                    <input type="text" placeholder="姓名" className="w-full pl-12 pr-4 py-4 rounded-2xl border-2 border-transparent bg-white/60 font-bold outline-none input-glow transition-all focus:bg-white placeholder-slate-400 shadow-sm" value={userName} onChange={(e) => setUserName(e.target.value)} />
                                </div>

                                <button onClick={startGame} disabled={!factoryCode || !deptCode || !employeeId || !userName} className="w-full bg-gradient-to-r from-benq to-[#8e56b8] hover:to-benq text-white py-5 rounded-2xl font-black text-xl shadow-xl shadow-purple-500/30 active:scale-95 transition-all flex items-center justify-center gap-3 mt-8 disabled:opacity-50 disabled:cursor-not-allowed btn-jelly">
                                    開始挑戰 <ArrowRight size={24} />
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            </div>
            );
          }

          // --- 手機版主要佈局 ---
          return (
            <div className="h-full flex flex-col overflow-hidden bg-slate-50">
                {/* 1. 上半部 (固定區域) */}
                <div className="flex-none bg-white shadow-md z-20 flex flex-col">
                    {/* Header: 進度 & 分數 */}
                    <div className="flex justify-between items-center px-4 py-2 border-b border-slate-100 bg-white">
                        <div className="flex items-center gap-2">
                            <span className="bg-purple-100 text-purple-700 px-2 py-0.5 rounded text-xs font-bold">Q{round}/{TOTAL_ROUNDS}</span>
                            <div className="font-mono font-bold text-orange-500 flex gap-1 items-center text-xs"><History size={12}/> {totalSeconds}s</div>
                        </div>
                        <div className="font-black text-benq text-lg">{score}</div>
                    </div>

                    {/* Content Row: Question Left, Lion Right */}
                    <div className="flex w-full h-[35vh] border-b border-slate-200">
                        {/* Left: Question Area */}
                        <div className="w-7/12 p-3 bg-slate-50 flex flex-col justify-center border-r border-slate-100">
                             {/* Title & Hint Row */}
                             <div className="flex flex-col gap-2 mb-1">
                                 <h1 className="font-bold text-slate-800 text-base leading-tight">{currentScenario?.title}</h1>
                                 {!hintVisible ? (
                                    <button onClick={showHint} className="self-start flex items-center gap-1 text-[10px] font-bold text-amber-600 bg-amber-100 px-2 py-1 rounded-full border border-amber-200 active:scale-95 whitespace-nowrap"><Lightbulb size={10}/> 提示</button>
                                ) : (
                                    <div className="self-start text-[10px] font-bold text-amber-600 bg-amber-50 px-2 py-1 rounded border border-amber-100 animate-fade-in">{currentScenario?.hint}</div>
                                )}
                             </div>
                             <p className="text-sm text-slate-600 leading-snug overflow-y-auto max-h-[100px]">{currentScenario?.description}</p>
                        </div>

                        {/* Right: Character Area */}
                        {/* NOTE: Removed overflow-hidden and increased bottom padding to pb-8 to lift the character up */}
                        <div className="w-5/12 relative bg-gradient-to-b from-white to-slate-100 flex justify-center items-end pb-8">
                             {/* Adjust scale to fit in this 1/2 width container */}
                             <WorkerFigure className="scale-[0.42] sm:scale-75 -translate-y-8" />
                        </div>
                    </div>
                </div>

                {/* 2. 下半部 (滾動區域)：裝備列表 */}
                <div className="flex-1 overflow-y-auto bg-slate-100 p-2 pb-24 custom-scrollbar">
                    <div className="grid grid-cols-4 gap-2">
                        {EQUIPMENT_LIST.map((item) => {
                            const isWorn = wornItems.find(i => i.id === item.id);
                            const Icon = item.Component;
                            return (
                                <button key={item.id} onClick={() => toggleItem(item)} disabled={gameState !== 'playing'}
                                    className={`relative flex flex-col items-center p-1 rounded-xl border-2 transition-all active:scale-95
                                    ${isWorn ? 'bg-purple-50 border-benq shadow-sm' : 'bg-white border-slate-200'}`}
                                >
                                    {isWorn && <div className="absolute top-1 right-1 text-benq"><CheckCircle size={14}/></div>}
                                    <div className="w-6 h-6 mb-1"><Icon /></div>
                                    <div className="text-xs font-bold text-slate-600 text-center leading-tight truncate w-full">{item.name}</div>
                                </button>
                            )
                        })}
                    </div>
                </div>

                {/* 3. 底部浮動按鈕 */}
                <div className="fixed bottom-0 left-0 w-full bg-white px-4 py-3 border-t border-slate-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-30">
                    <div className="max-w-md mx-auto flex gap-2">
                        <button onClick={() => setWornItems([])} className="p-3 rounded-xl bg-slate-100 text-slate-500 border border-slate-300 active:scale-95"><RotateCcw size={18}/></button>
                        {gameState === 'playing' ? (
                            <button onClick={checkAnswer} className="flex-1 bg-benq hover:bg-benq-dark text-white font-bold rounded-xl py-3 shadow-lg shadow-purple-200 active:scale-95 transition-transform flex justify-center items-center gap-2 text-sm">
                                確認裝備 <CheckCircle size={16}/>
                            </button>
                        ) : (
                            <button onClick={nextRound} className="flex-1 bg-blue-600 text-white font-bold rounded-xl py-3 shadow-lg shadow-blue-200 active:scale-95 transition-transform flex justify-center items-center gap-2 text-sm">
                                {round >= TOTAL_ROUNDS ? '查看結果' : '下一題'} <ArrowRight size={16}/>
                            </button>
                        )}
                    </div>
                </div>

                {/* 結果彈窗 (Overlay) */}
                {message && gameState !== 'playing' && gameState !== 'leaderboard' && gameState !== 'result' && (
                    <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white/95 backdrop-blur shadow-2xl border-2 border-slate-100 rounded-2xl p-6 w-4/5 text-center z-50 animate-fade-in">
                        <div className={`text-xl font-black mb-2 ${gameState === 'success' ? 'text-green-500' : 'text-red-500'}`}>
                            {gameState === 'success' ? '答對了！' : '哎呀...'}
                        </div>
                        <p className="text-sm text-slate-600 font-bold mb-4">{message}</p>
                        
                        {/* 顯示正確答案區域 */}
                        {failDetails && (
                            <div className="bg-red-50 rounded-xl p-3 text-left border border-red-100 text-xs">
                                {failDetails.type === 'incorrect' && failDetails.missing && failDetails.missing.length > 0 && (
                                    <div className="mb-2">
                                        <div className="font-bold text-red-500 flex items-center gap-1 mb-1"><AlertTriangle size={12}/> 缺少裝備：</div>
                                        <div className="text-slate-700 pl-4">{failDetails.missing.join('、')}</div>
                                    </div>
                                )}
                                {failDetails.type === 'forbidden' && (
                                    <div className="mb-2 text-red-600 font-bold">
                                        {failDetails.text}
                                    </div>
                                )}
                                <div className="mt-2 pt-2 border-t border-red-200">
                                    <div className="font-bold text-emerald-600 flex items-center gap-1 mb-1"><CheckCircle size={12}/> 正確配置：</div>
                                    <div className="text-slate-700 pl-4">{failDetails.correctList.join('、')}</div>
                                </div>
                            </div>
                        )}
                    </div>
                )}
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SafetyGearGame />);
    </script>
</body>
</html>
