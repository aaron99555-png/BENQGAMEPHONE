<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <!-- é—œéµï¼šç¦æ­¢ç¸®æ”¾ï¼Œç¢ºä¿ APP è³ªæ„Ÿ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ˜åŸºææ–™å·¥å®‰é˜²è­·å…·æŒ‘æˆ°</title>
    
    <style>
        body { 
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; 
            margin: 0; 
            padding: 0; 
            background-color: #f8fafc;
            /* é—œéµï¼šé˜²æ­¢æ‰‹æ©Ÿä¸‹æ‹‰åˆ·æ–°å°è‡´é é¢è·³å‹• */
            overscroll-behavior: none;
        }
        .loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: #ffffff; z-index: 9999; text-align: center;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid #652d90; border-radius: 50%; /* BenQ Purple */
            width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(101, 45, 144, 0.3); border-radius: 4px; }

        /* èƒŒæ™¯è£é£¾å‹•ç•« */
        .bg-gradient-animate {
            background: linear-gradient(-45deg, #652d90, #4a1d6e, #8e56b8, #652d90);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>

    <script>
        function handleScriptError(e) {
            alert("âš ï¸ ç¶²è·¯è³‡æºè¼‰å…¥å¤±æ•—ï¼è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚");
        }
    </script>
    
    <script src="https://cdn.tailwindcss.com" onerror="handleScriptError(this)"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js" onerror="handleScriptError(this)"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" onerror="handleScriptError(this)"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" onerror="handleScriptError(this)"></script>

    <script>
        window.onload = function() {
            if (typeof tailwind !== 'undefined') {
                tailwind.config = {
                    theme: {
                        extend: {
                            colors: {
                                benq: {
                                    DEFAULT: '#652d90', // BenQ Purple
                                    hover: '#502379',
                                    light: '#8e56b8',
                                    dark: '#4a1d6e',
                                }
                            },
                            animation: {
                                'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                                'shake': 'shake 0.5s ease-in-out',
                                'fade-in': 'fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                                'slide-up': 'slideUp 0.5s ease-out',
                            },
                            keyframes: {
                                shake: {
                                    '0%, 100%': { transform: 'translateX(0)' },
                                    '25%': { transform: 'translateX(-5px)' },
                                    '75%': { transform: 'translateX(5px)' },
                                },
                                fadeIn: {
                                    'from': { opacity: '0', transform: 'translateY(10px)' },
                                    'to': { opacity: '1', transform: 'translateY(0)' },
                                },
                                slideUp: {
                                    'from': { opacity: '0', transform: 'translateY(20px)' },
                                    'to': { opacity: '1', transform: 'translateY(0)' },
                                }
                            }
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-100 h-[100dvh] overflow-hidden flex flex-col">
    
    <div id="root" class="h-full flex flex-col">
        <div class="loading-screen">
            <div class="loading-spinner"></div>
            <h2 class="text-gray-600 text-xl font-bold">è¼‰å…¥ä¸­...</h2>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icon Components ---
        const IconBase = ({ size = 24, className = "", children, ...props }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>);
        const CheckCircle = (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></IconBase>;
        const XCircle = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></IconBase>;
        const RotateCcw = (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></IconBase>;
        const ArrowRight = (p) => <IconBase {...p}><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></IconBase>;
        const Construction = (p) => <IconBase {...p}><rect x="2" y="6" width="20" height="8" rx="1"></rect><path d="M17 14v7"></path><path d="M7 14v7"></path><path d="M17 3v3"></path><path d="M7 3v3"></path><path d="M10 14 2.3 6.3"></path><path d="m14 6 7.7 7.7"></path><path d="m8 6 8 8"></path></IconBase>;
        const Timer = (p) => <IconBase {...p}><line x1="10" y1="2" x2="14" y2="2"></line><line x1="12" y1="14" x2="15.51" y2="11.51"></line><circle cx="12" cy="14" r="8"></circle></IconBase>;
        const Lightbulb = (p) => <IconBase {...p}><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5A6 6 0 0 0 6 8c0 1 .5 2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"></path><path d="M9 18h6"></path><path d="M10 22h4"></path></IconBase>;
        const ShieldAlert = (p) => <IconBase {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></IconBase>;
        const Hammer = (p) => <IconBase {...p}><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"></path><path d="M17.64 15 22 10.64"></path><path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25V7.86c0-.55-.45-1-1-1H16.5c-.55 0-1 .45-1 1v.36c0 .84-.33 1.65-.93 2.25L13.36 11.7a2.5 2.5 0 0 0 0 3.54l1.25 1.25a2.5 2.5 0 0 0 3.54 0z"></path><path d="m3.5 3.5 6 6"></path><path d="m2 2 2 2"></path></IconBase>;
        const AlertTriangle = (p) => <IconBase {...p}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></IconBase>;
        const Info = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></IconBase>;
        const Trophy = (p) => <IconBase {...p}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M9 14.66V17a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-2.34l-3.14-3.14a3 3 0 0 1-.72-1.54l-.52-2.28"></path><path d="M19.42 4.94A2 2 0 0 0 18 4H6a2 2 0 0 0-1.42.94L2 9.07a2.12 2.12 0 0 0 .59 2.14l8.28 7.37a2 2 0 0 0 2.26 0l8.28-7.37a2.12 2.12 0 0 0 .59-2.14z"></path></IconBase>;
        const Save = (p) => <IconBase {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></IconBase>;
        const ListOrdered = (p) => <IconBase {...p}><line x1="10" y1="6" x2="21" y2="6"></line><line x1="10" y1="12" x2="21" y2="12"></line><line x1="10" y1="18" x2="21" y2="18"></line><path d="M4 6h1v4"></path><path d="M4 10h2"></path><path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"></path></IconBase>;
        const Play = (p) => <IconBase {...p}><polygon points="5 3 19 12 5 21 5 3"></polygon></IconBase>;
        const History = (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path><path d="M12 7v5l4 2"></path></IconBase>;
        const Building2 = (p) => <IconBase {...p}><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"></path><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"></path><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"></path><path d="M10 6h4"></path><path d="M10 10h4"></path><path d="M10 14h4"></path><path d="M10 18h4"></path></IconBase>;
        const UserCheck = (p) => <IconBase {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><polyline points="16 11 18 13 22 9"></polyline></IconBase>;
        const Upload = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></IconBase>;
        const User = (p) => <IconBase {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>;
        const Briefcase = (p) => <IconBase {...p}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></IconBase>;
        const MapPin = (p) => <IconBase {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconBase>;

        // ... [PPE Icons and SCENARIOS omitted for brevity] ...
        const IconHelmet = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 36c0-14 10-26 28-26s28 12 28 26v4H4v-4z" fill="#FBBF24" stroke="#D97706" /><path d="M32 10v4M4 36h56M12 36c0-4 2-8 6-8h28c4 0 6 4 6 8" stroke="#D97706" strokeLinecap="round"/><path d="M28 14h8" stroke="#D97706" strokeWidth="3"/></svg>;
        const IconGoggles = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M12 28c0-6 4-10 10-10h6c2 0 4 2 4 4s2 4 4 4 4-2 4-4 2-4 4-4h6c6 0 10 4 10 10v6c0 6-4 10-10 10h-6c-2 0-4-2-4-4s-2-4-4-4-4 2-4 4-2 4-4 4h-6c-6 0-10-4-10-10v-6z" fill="#BFDBFE" stroke="#2563EB" strokeWidth="3"/><path d="M4 30h8M52 30h8" stroke="#1F2937" strokeWidth="3" strokeLinecap="round"/></svg>;
        const IconWeldingMask = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><rect x="14" y="8" width="36" height="48" rx="8" fill="#1F2937" stroke="#000" strokeWidth="2"/><rect x="20" y="20" width="24" height="12" rx="2" fill="#111827" stroke="#F59E0B" strokeWidth="2"/><path d="M22 26h20" stroke="#F59E0B" strokeWidth="1" opacity="0.5"/></svg>;
        const IconFaceShield = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M16 12h32v4H16z" fill="#374151" stroke="#000" strokeWidth="2"/><path d="M16 16v32c0 8 8 12 16 12s16-4 16-12V16H16z" fill="#A7F3D0" stroke="#059669" strokeWidth="2" fillOpacity="0.6"/><path d="M24 24l16 16" stroke="#059669" strokeWidth="1" opacity="0.5"/></svg>;
        const IconEarmuffs = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M12 18a4 4 0 0 1 4-4h32a4 4 0 0 1 4 4v20" stroke="#374151" strokeWidth="3" strokeLinecap="round"/><rect x="6" y="24" width="12" height="24" rx="6" fill="#F97316" stroke="#C2410C" strokeWidth="2"/><rect x="46" y="24" width="12" height="24" rx="6" fill="#F97316" stroke="#C2410C" strokeWidth="2"/><path d="M10 30h4M50 30h4" stroke="#FFF" strokeOpacity="0.5"/></svg>;
        const IconGasMask = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M16 16h32v24c0 10-8 16-16 16s-16-6-16-16V16z" fill="#374151" stroke="#111827" strokeWidth="2"/><circle cx="22" cy="28" r="6" fill="#111827" stroke="#6B7280" strokeWidth="2"/><circle cx="42" cy="28" r="6" fill="#111827" stroke="#6B7280" strokeWidth="2"/><rect x="26" y="40" width="12" height="12" rx="2" fill="#4B5563" stroke="#9CA3AF" strokeWidth="2"/></svg>;
        const IconN95 = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M14 20c0-2 18-6 18-6s18 4 18 6c0 10-4 26-18 26s-18-16-18-26z" fill="#F9FAFB" stroke="#9CA3AF" strokeWidth="2"/><path d="M8 24h6M50 24h6" stroke="#FCA5A5" strokeWidth="2"/><circle cx="24" cy="28" r="2" fill="#D1D5DB"/></svg>;
        const IconHarness = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M16 8v48M48 8v48" stroke="#EF4444" strokeWidth="4"/><path d="M16 20h32M16 40h32" stroke="#EF4444" strokeWidth="4"/><path d="M16 12l32 40M48 12L16 52" stroke="#B91C1C" strokeWidth="3"/></svg>;
        const IconVest = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M12 12h12l8 16 8-16h12v40H12V12z" fill="#A3E635" stroke="#4D7C0F" strokeWidth="2"/><path d="M12 36h40M12 44h40" stroke="#E5E7EB" strokeWidth="4"/><path d="M22 12v40M42 12v40" stroke="#E5E7EB" strokeWidth="4"/></svg>;
        const IconApron = () => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M22 8h20v8H22z" stroke="#1D4ED8" strokeWidth="2"/><path d="M18 16h28l4 8v32H14V24l4-8z" fill="#2563EB" stroke="#1E40AF" strokeWidth="2"/><path d="M24 30h16" stroke="#60A5FA" strokeWidth="2" opacity="0.5"/></svg>;
        const IconGlove = ({ color, type }) => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M20 54V30a4 4 0 0 1 8 0v-4a4 4 0 0 1 8 0v-2a4 4 0 0 1 8 0v4a4 4 0 0 1 8 0v26H20z" fill={color} stroke="#4B5563" strokeWidth="2"/><path d="M20 50h32" stroke="#000" strokeOpacity="0.1"/>{type === 'dot' && <circle cx="32" cy="40" r="1" fill="#000" opacity="0.2"/>}{type === 'line' && <path d="M28 36v10" stroke="#000" opacity="0.1"/>}</svg>;
        const IconBoot = ({ color, sole }) => <svg viewBox="0 0 64 64" className="w-full h-full" fill="none"><path d="M18 12h16v24h14c4 0 6 4 6 8v8H14V16c0-2 2-4 4-4z" fill={color} stroke="#1F2937" strokeWidth="2"/><path d="M14 52h40v4H14z" fill={sole} stroke="#000" strokeWidth="1"/><path d="M18 16h16" stroke="#FFF" strokeOpacity="0.2"/></svg>;

        const EQUIPMENT_LIST = [
          { id: 'helmet', name: 'å·¥æ¥­å®‰å…¨å¸½', Component: IconHelmet, category: 'head', color: 'bg-yellow-400' },
          { id: 'goggles', name: 'å®‰å…¨è­·ç›®é¡', Component: IconGoggles, category: 'eyes', color: 'bg-blue-200' },
          { id: 'mask_welding', name: 'ç„Šæ¥é¢ç½©', Component: IconWeldingMask, category: 'eyes', color: 'bg-gray-800' },
          { id: 'shield_face', name: 'é˜²è­·é¢ç½©', Component: IconFaceShield, category: 'eyes', color: 'bg-emerald-200' },
          { id: 'earmuffs', name: 'é˜²éŸ³è€³ç½©', Component: IconEarmuffs, category: 'ears', color: 'bg-orange-400' },
          { id: 'mask_gas', name: 'é˜²æ¯’é¢å…·', Component: IconGasMask, category: 'face', color: 'bg-gray-700' },
          { id: 'mask_dust', name: 'N95å£ç½©', Component: IconN95, category: 'face', color: 'bg-white' },
          { id: 'harness', name: 'é«˜ç©ºå®‰å…¨å¸¶', Component: IconHarness, category: 'body_acc', color: 'bg-red-500' },
          { id: 'vest', name: 'åå…‰èƒŒå¿ƒ', Component: IconVest, category: 'body', color: 'bg-lime-400' },
          { id: 'apron', name: 'é˜²è­·åœè£™', Component: IconApron, category: 'body_outer', color: 'bg-blue-700' },
          { id: 'gloves_cotton', name: 'æ£‰ç´—æ‰‹å¥—', Component: () => <IconGlove color="#E5E7EB" type="dot"/>, category: 'hands', color: 'bg-gray-200' },
          { id: 'gloves_rubber', name: 'è€åŒ–å­¸æ‰‹å¥—', Component: () => <IconGlove color="#A855F7" type="line"/>, category: 'hands', color: 'bg-purple-500' },
          { id: 'gloves_insulation', name: 'çµ•ç·£æ‰‹å¥—', Component: () => <IconGlove color="#EA580C" />, category: 'hands', color: 'bg-orange-600' },
          { id: 'gloves_cut', name: 'é˜²åˆ‡å‰²æ‰‹å¥—', Component: () => <IconGlove color="#94A3B8" type="line"/>, category: 'hands', color: 'bg-slate-400' },
          { id: 'gloves_leather', name: 'çš®é©æ‰‹å¥—', Component: () => <IconGlove color="#B45309" />, category: 'hands', color: 'bg-amber-700' },
          { id: 'safety_shoes', name: 'é‹¼é ­å®‰å…¨é‹', Component: () => <IconBoot color="#1F2937" sole="#000"/>, category: 'feet', color: 'bg-slate-800' },
          { id: 'boots_rubber', name: 'é˜²è­·é›¨é‹', Component: () => <IconBoot color="#CA8A04" sole="#854D0E"/>, category: 'feet', color: 'bg-yellow-600' },
        ];

        const SCENARIOS = [
          { id: 1, title: 'é«˜ç©ºé·¹æ¶ä½œæ¥­', description: 'åœ¨ 5 å…¬å°ºé«˜çš„é·¹æ¶ä¸Šç¶­è­·å¤–ç‰†ï¼Œä¸Šæ–¹å¶çˆ¾æœ‰è½çŸ³ã€‚', required: ['helmet', 'harness', 'safety_shoes'], hint: 'ã€å¢œè½å±å®³ã€‘é«˜è™•ä½œæ¥­é ˆé…æˆ´å®‰å…¨å¸¶ï¼Œä¸¦ä¿è­·é ­éƒ¨èˆ‡è…³éƒ¨ã€‚' },
          { id: 2, title: 'èª¿è† å®¤æº¶åŠ‘èª¿é…', description: 'å®¤å…§å……æ»¿æœ‰æ©Ÿæº¶åŠ‘æ°£å‘³ï¼Œæ¶²é«”å…·è…è•æ€§ä¸”å®¹æ˜“å™´æ¿ºã€‚', required: ['mask_gas', 'goggles', 'gloves_rubber', 'apron'], hint: 'ã€åŒ–å­¸å±å®³ã€‘éœ€é˜²æ­¢å¸å…¥æ¯’æ°£ï¼Œä¸¦ä¿è­·çœ¼ã€èº«ã€æ‰‹ä¸è¢«è…è•ã€‚' },
          { id: 3, title: 'ç™¼é›»æ©Ÿæˆ¿å·¡æª¢', description: 'æ©Ÿæˆ¿å…§ç™¼é›»æ©Ÿé‹è½‰ä¸­ï¼Œå™ªéŸ³é«˜é” 95 åˆ†è²ã€‚', required: ['earmuffs', 'safety_shoes', 'helmet'], hint: 'ã€å™ªéŸ³å±å®³ã€‘ä¿è­·è½åŠ›æ˜¯é¦–è¦ä»»å‹™ï¼ŒåŒæ™‚æ³¨æ„é ­éƒ¨èˆ‡è…³éƒ¨å®‰å…¨ã€‚' },
          { id: 4, title: 'æ‰‹æŒç ‚è¼ªæ©Ÿç ”ç£¨', description: 'ç ”ç£¨é‡‘å±¬é›¶ä»¶ï¼Œæœ‰å¤§é‡ç«èŠ±èˆ‡é‡‘å±¬ç²‰å¡µé£›æ•£ã€‚', required: ['goggles', 'mask_dust', 'gloves_cotton', 'earmuffs'], hint: 'ã€ç²‰å¡µ/ç«èŠ±ã€‘é˜²è­·çœ¼ã€è‚ºã€æ‰‹ï¼Œä¸”ç ”ç£¨å™ªéŸ³å¤§éœ€æˆ´è€³ç½©ã€‚' },
          { id: 5, title: 'å¤œé–“é“è·¯æ¶ä¿®', description: 'å¤œé–“åœ¨è»Šæµé‡å¤§çš„é¦¬è·¯é€²è¡Œå‘æ´ä¿®è£œã€‚', required: ['helmet', 'vest', 'safety_shoes'], hint: 'ã€è¢«æ’å±å®³ã€‘æœ€é‡è¦çš„æ˜¯é«˜å¯è¦–åº¦åå…‰èƒŒå¿ƒã€‚' },
          { id: 6, title: 'é…é›»ç›¤æ´»ç·šä½œæ¥­', description: 'æª¢ä¿® 220V æœªæ–·é›»çš„é…é›»ç›¤è¨­å‚™ã€‚', required: ['helmet', 'gloves_insulation', 'safety_shoes', 'shield_face'], hint: 'ã€æ„Ÿé›»å±å®³ã€‘çµ•ç·£æ‰‹å¥—èˆ‡é¢ç½©é˜²æ­¢é›»å¼§ç¼å‚·æ˜¯é—œéµã€‚' },
          { id: 7, title: 'é‹¼æ§‹é›»éŠ²ä½œæ¥­', description: 'ç„Šæ¥é‹¼æï¼Œç”¢ç”Ÿå¼·çƒˆç´«å¤–ç·šå¼·å…‰ã€é«˜æº«èˆ‡é‡‘å±¬å™´æ¿ºã€‚', required: ['mask_welding', 'gloves_leather', 'apron', 'safety_shoes'], hint: 'ã€å…‰å®³/é«˜æº«ã€‘éœ€ç„Šæ¥é¢ç½©æ“‹å¼·å…‰ï¼Œçš®é©æ‰‹å¥—èˆ‡åœè£™é˜²é«˜æº«å™´æ¿ºã€‚' },
          { id: 8, title: 'å‰²è‰æ©Ÿé™¤è‰', description: 'ä½¿ç”¨èƒŒè² å¼å‰²è‰æ©Ÿï¼Œåœ°é¢ç¢çŸ³å®¹æ˜“é£›æ¿ºã€‚', required: ['shield_face', 'boots_rubber', 'apron', 'gloves_cotton'], hint: 'ã€é£›è½ç‰©å±å®³ã€‘ç¢çŸ³æ˜“å‚·è‡‰èˆ‡è…¿ï¼Œéœ€é¢ç½©èˆ‡é•·ç­’é›¨é‹/åœè£™ã€‚' },
          { id: 9, title: 'å»¢æ£„ç»ç’ƒæ¸…ç†', description: 'æ¸…ç†å«æœ‰å¤§é‡ç¢ç»ç’ƒèˆ‡å°–éŠ³éµç‰‡çš„å»¢æ£„ç‰©ã€‚', required: ['gloves_cut', 'safety_shoes', 'helmet'], hint: 'ã€åˆ‡å‰²å±å®³ã€‘é¦–é‡æ‰‹éƒ¨é˜²åˆ‡å‰²èˆ‡è¶³éƒ¨é˜²ç©¿åˆºã€‚' },
          { id: 10, title: 'å¼·é…¸åœ°æ¿æ¸…æ´—', description: 'åœ°é¢ç©æ°´ä¸”ä½¿ç”¨å¼·é…¸æ¸…æ½”åŠ‘ï¼Œæ¥µåº¦æ¿•æ»‘ã€‚', required: ['boots_rubber', 'gloves_rubber', 'goggles', 'mask_gas'], hint: 'ã€åŒ–å­¸/è·Œå€’ã€‘éœ€é˜²æ»‘é˜²æ°´é›¨é‹ï¼Œèˆ‡å®Œæ•´çš„æŠ—é…¸é˜²è­·ã€‚' },
          { id: 11, title: 'é‘½åºŠ/è»ŠåºŠæ“ä½œ', description: 'æ“ä½œé«˜é€Ÿæ—‹è½‰çš„æ©Ÿå…·é€²è¡Œé‡‘å±¬é‘½å­”èˆ‡åŠ å·¥ã€‚', required: ['goggles', 'safety_shoes'], forbidden: ['hands'], hint: 'ã€æ²å¤¾å±å®³ã€‘æ—‹è½‰æ©Ÿå…·ã€Œçµ•å°ç¦æ­¢ã€æˆ´æ‰‹å¥—ï¼Œä»¥å…è¢«æ²å…¥ï¼' },
          { id: 12, title: 'é«˜æº«ç†”ç…‰çˆä½œæ¥­', description: 'åœ¨é‘„é€ å» é«˜æº«ç†”çˆæ—ä½œæ¥­ï¼Œæœ‰ç†±è¼»å°„èˆ‡é‡‘å±¬æ¶²å™´æ¿ºé¢¨éšªã€‚', required: ['helmet', 'shield_face', 'gloves_leather', 'apron', 'safety_shoes'], hint: 'ã€é«˜æº«å±å®³ã€‘å…¨èº«éœ€è€é«˜æº«é˜²è­·ï¼šçš®é©æ‰‹å¥—ã€åœè£™ã€é¢ç½©ã€‚' },
          { id: 13, title: 'ç ´ç¢æ©Ÿæ‰“çŸ³ä½œæ¥­', description: 'ä½¿ç”¨å¤§å‹æ°£å‹•ç ´ç¢æ©Ÿæ‹†é™¤æ··æ³¥åœŸï¼Œå™ªéŸ³æ¥µå¤§ä¸”ç²‰å¡µå¤šã€‚', required: ['earmuffs', 'mask_dust', 'goggles', 'helmet', 'safety_shoes', 'gloves_cotton'], hint: 'ã€å™ªéŸ³/ç²‰å¡µã€‘é«˜åˆ†è²å™ªéŸ³éœ€è€³ç½©ï¼Œä¸¦é˜²è­·ç²‰å¡µèˆ‡é£›çŸ³ã€‚' },
          { id: 14, title: 'è¼¸é€å¸¶ç¶­ä¿® (é‹è½‰ä¸­)', description: 'åœ¨é‹è½‰ä¸­çš„è¼¸é€å¸¶æ—é€²è¡Œç›®è¦–æª¢æŸ¥ (ä¸å¯æ¥è§¸)ã€‚', required: ['helmet', 'safety_shoes', 'goggles'], forbidden: ['hands'], hint: 'ã€æ²å¤¾å±å®³ã€‘é è¿‘é‹è½‰ä¸­æ©Ÿæ¢°ï¼Œåš´ç¦æˆ´æ‰‹å¥—æˆ–å¯¬é¬†è¡£ç‰©ä»¥å…æ²å…¥ã€‚' },
          { id: 15, title: 'åŒ–å­¸æ§½è»Šå¸æ–™ (é…¸æ¶²)', description: 'é€£æ¥ç®¡ç·šå¸æ”¶é«˜è…è•æ€§é…¸æ¶²ï¼Œæ¥å£è™•å¯èƒ½å™´æ¿ºã€‚', required: ['shield_face', 'mask_gas', 'apron', 'gloves_rubber', 'boots_rubber'], hint: 'ã€å™´æ¿ºå±å®³ã€‘æœ€é«˜è¦æ ¼åŒ–å­¸é˜²è­·ï¼šé¢ç½©+é˜²æ¯’+æ©¡è† æ‰‹å¥—+åœè£™+é›¨é‹ã€‚' },
          { id: 16, title: 'å †é«˜æ©Ÿé§•é§›', description: 'é§•é§›å †é«˜æ©Ÿåœ¨å€‰åº«é–“æ¬é‹è²¨ç‰©ï¼Œéœ€æ³¨æ„é ­é ‚è²¨ç‰©èˆ‡å‘¨é­äººå“¡ã€‚', required: ['helmet', 'vest', 'safety_shoes'], hint: 'ã€è¢«æ’/ç‰©é«”é£›è½ã€‘é§•é§›éœ€æˆ´å®‰å…¨å¸½é˜²è­·è½ç‰©ï¼Œç©¿èƒŒå¿ƒæå‡èƒ½è¦‹åº¦ã€‚' },
          { id: 17, title: 'é‡‘å±¬åˆ‡å‰²æ“ä½œ', description: 'ä½¿ç”¨åˆ‡å‰²æ©Ÿé€²è¡Œé‡‘å±¬åˆ‡æ–·ï¼Œæœ‰éµå±‘é£›æ¿ºèˆ‡æ¥µå¤§å™ªéŸ³ã€‚', required: ['helmet', 'earmuffs', 'shield_face', 'gloves_cut', 'safety_shoes'], hint: 'ã€åˆ‡å‰²/å™ªéŸ³ã€‘éœ€é˜²åˆ‡å‰²æ‰‹å¥—ã€é¢ç½©æ“‹éµå±‘ï¼Œä»¥åŠè€³ç½©é˜²å™ªéŸ³ã€‚' },
          { id: 18, title: 'ç²‰å¡µä½œæ¥­', description: 'ç²’å­æ·»åŠ ä½œæ¥­ï¼Œç©ºæ°£ä¸­æ‡¸æµ®å¤§é‡ç´°å¾®ç²‰å¡µã€‚', required: ['mask_dust', 'goggles', 'helmet', 'safety_shoes'], hint: 'ã€ç²‰å¡µå±å®³ã€‘é«˜æ¿ƒåº¦ç²‰å¡µç’°å¢ƒï¼ŒN95ç­‰ç´šä»¥ä¸Šå£ç½©èˆ‡è­·ç›®é¡æ˜¯å¿…é ˆçš„ã€‚' },
          { id: 19, title: 'æ¶²æ…‹æ°®åˆ†è£æ“ä½œ', description: 'åˆ†è£é›¶ä¸‹ 196 åº¦æ¶²æ…‹æ°®ï¼Œæ¥µä½æº«æ¶²é«”å¯èƒ½å™´æ¿ºã€‚', required: ['shield_face', 'gloves_leather', 'apron', 'safety_shoes'], hint: 'ã€ä½æº«å±å®³ã€‘é˜²æ­¢å‡å‚·èˆ‡å™´æ¿ºï¼Œéœ€é¢ç½©èˆ‡åšçµ•ç·£æ‰‹å¥—ï¼ˆå¦‚çš®é©ï¼‰ã€‚' },
          { id: 20, title: 'å±€é™ç©ºé–“æ°£é«”åµæ¸¬', description: 'é€²å…¥é€šé¢¨ä¸è‰¯çš„åœ°ä¸‹é“å‰ï¼Œéœ€å…ˆç¢ºèªæ°£é«”ç‹€æ³ã€‚', required: ['helmet', 'mask_gas', 'safety_shoes', 'harness'], hint: 'ã€ç¼ºæ°§/ä¸­æ¯’ã€‘é›–æ˜¯åµæ¸¬ï¼Œä½†éœ€é è¨­æœ‰å±å®³ï¼šä½©æˆ´å‘¼å¸é˜²è­·èˆ‡æ•‘æ´ç”¨å®‰å…¨å¸¶ã€‚' }
        ];

        const TOTAL_ROUNDS = 10;

        function SafetyGearGame() {
          const [currentScenario, setCurrentScenario] = useState(null);
          const [wornItems, setWornItems] = useState([]);
          const [gameState, setGameState] = useState('start'); 
          const [message, setMessage] = useState('');
          const [failDetails, setFailDetails] = useState(null);
          const [score, setScore] = useState(0);
          const [hintVisible, setHintVisible] = useState(false);
          const [totalSeconds, setTotalSeconds] = useState(0);
          const [isActive, setIsActive] = useState(false);
          
          const [round, setRound] = useState(1);
          const [usedScenarioIds, setUsedScenarioIds] = useState([]);
          const [factoryCode, setFactoryCode] = useState('');
          const [deptCode, setDeptCode] = useState('');
          const [employeeId, setEmployeeId] = useState('');
          const [userName, setUserName] = useState('');
          const [isBlinking, setIsBlinking] = useState(false);

          useEffect(() => {
            let interval = null;
            if (isActive) {
              interval = setInterval(() => {
                setTotalSeconds(s => s + 1);
              }, 1000);
            }
            return () => clearInterval(interval);
          }, [isActive]);

          useEffect(() => {
            const blinkInterval = setInterval(() => {
              setIsBlinking(true);
              setTimeout(() => setIsBlinking(false), 200);
            }, 4000);
            return () => clearInterval(blinkInterval);
          }, []);

          const startGame = () => {
            setScore(0);
            setTotalSeconds(0);
            setRound(1);
            setUsedScenarioIds([]);
            pickNextLevel([]);
          };

          const pickNextLevel = (currentUsedIds) => {
            const availableScenarios = SCENARIOS.filter(s => !currentUsedIds.includes(s.id));
            if (availableScenarios.length === 0) {
              setGameState('result');
              setIsActive(false);
              return;
            }
            const randomIndex = Math.floor(Math.random() * availableScenarios.length);
            const nextScenario = availableScenarios[randomIndex];
            setCurrentScenario(nextScenario);
            setUsedScenarioIds([...currentUsedIds, nextScenario.id]);
            setWornItems([]);
            setGameState('playing');
            setMessage('');
            setFailDetails(null);
            setHintVisible(false);
            setIsActive(true); 
          };

          const nextRound = () => {
            if (round >= TOTAL_ROUNDS) {
              setGameState('result');
              setIsActive(false); 
            } else {
              setRound(r => r + 1);
              pickNextLevel(usedScenarioIds);
            }
          };

          const toggleItem = (item) => {
            if (gameState !== 'playing') return;
            setWornItems(prev => {
              const isWorn = prev.find(i => i.id === item.id);
              if (isWorn) {
                return prev.filter(i => i.id !== item.id);
              } else {
                let newItems = prev.filter(i => i.category !== item.category);
                return [...newItems, item];
              }
            });
          };

          const showHint = () => {
            if (!hintVisible && gameState === 'playing') {
              setHintVisible(true);
              setScore(s => Math.max(0, s - 20));
            }
          };

          const checkAnswer = () => {
            if (!currentScenario) return;
            setIsActive(false); 

            const requiredIds = currentScenario.required.sort();
            const wornIds = wornItems.map(i => i.id);
            const missingItems = requiredIds.filter(id => !wornIds.includes(id));
            const extraItems = wornIds.filter(id => !requiredIds.includes(id));
            const requiredNames = requiredIds.map(id => EQUIPMENT_LIST.find(i => i.id === id)?.name);
            const missingNames = missingItems.map(id => EQUIPMENT_LIST.find(i => i.id === id)?.name);

            const isEntanglementHazard = currentScenario.forbidden && currentScenario.forbidden.includes('hands');
            const hasGloves = wornItems.some(i => i.category === 'hands');
            
            let isSuccess = false;
            let failMsg = '';

            if (isEntanglementHazard && hasGloves) {
                isSuccess = false;
                failMsg = 'æ²å¤¾å±å®³ï¼šæ—‹è½‰æ©Ÿå…·åš´ç¦æˆ´æ‰‹å¥—ï¼';
                setFailDetails({ type: 'forbidden', text: 'æ—‹è½‰æ©Ÿå…·ç¦æ­¢æˆ´æ‰‹å¥—ï¼Œå› ç‚ºæœƒè¢«æ²å…¥æ©Ÿæ¢°ä¸­é€ æˆåš´é‡å‚·å®³ã€‚', correctList: requiredNames });
            } else if (missingItems.length === 0 && extraItems.length === 0) {
                isSuccess = true;
            } else {
                isSuccess = false;
                failMsg = 'é˜²è­·ä¸å®Œæ•´æˆ–éŒ¯èª¤ï¼';
                setFailDetails({ type: 'incorrect', missing: missingNames, correctList: requiredNames });
            }

            if (isSuccess) {
              setGameState('success');
              setScore(s => s + 100);
              setMessage(`å®Œç¾é˜²è­·ï¼`);
            } else {
              setGameState('failure');
              setMessage(failMsg);
            }
          };

          const WorkerFigure = ({ className = "" }) => {
            const getItemByCat = (cat) => wornItems.find(i => i.category === cat);
            const head = getItemByCat('head');
            const eyes = getItemByCat('eyes'); 
            const face = getItemByCat('face');
            const ears = getItemByCat('ears');
            const body = getItemByCat('body');
            const bodyAcc = getItemByCat('body_acc');
            const bodyOuter = getItemByCat('body_outer');
            const hands = getItemByCat('hands');
            const feet = getItemByCat('feet');

            const breatheClass = gameState === 'playing' ? '' : ''; 
            const successClass = gameState === 'success' ? '' : ''; 
            const failClass = gameState === 'failure' ? '' : ''; 

            return (
              <div className={`relative w-full h-full rounded-2xl flex flex-col items-center justify-end shrink-0
                ${gameState === 'success' ? 'bg-green-100/50' : gameState === 'failure' ? 'bg-red-50/50' : 'bg-transparent'} transition-all`}>
                
                <div className={`relative flex flex-col items-center transform transition-transform duration-500 origin-bottom z-10 -mb-2 ${className} ${successClass} ${failClass}`}>
                  
                  {/* é˜¿åŸºç…é ­éƒ¨ (æ›´æ–°ç‰ˆ) */}
                  <div className={`relative z-30 flex flex-col items-center w-40 h-40 -mb-4 ${breatheClass}`}>
                    
                    {/* é¬ƒæ¯› (æœ€åº•å±¤) - æ£•è‰²åœ“å½¢ */}
                    <div className="absolute top-0 left-0 w-full h-full z-0 scale-110">
                       <svg viewBox="0 0 100 100" className="w-full h-full overflow-visible">
                          <circle cx="50" cy="50" r="48" fill="#C27803" stroke="#92400E" strokeWidth="2" />
                       </svg>
                    </div>

                    {ears && (
                      <div className="absolute top-8 w-full flex justify-between px-2 z-20 pointer-events-none">
                         <div className={`w-5 h-10 ${ears.color} rounded-lg border-2 border-gray-700 shadow-sm -ml-4`}></div>
                         <div className={`w-5 h-10 ${ears.color} rounded-lg border-2 border-gray-700 shadow-sm -mr-4`}></div>
                         <div className="absolute -top-4 left-1/2 -translate-x-1/2 w-44 h-12 border-t-4 border-gray-700 rounded-full"></div>
                      </div>
                    )}

                    <div className="relative w-28 h-32 z-10 top-2">
                       <svg viewBox="0 0 100 120" className="w-full h-full overflow-visible">
                          {/* è€³æœµ */}
                          <circle cx="20" cy="10" r="12" fill="#FCD34D" stroke="#C27803" strokeWidth="2" />
                          <circle cx="20" cy="10" r="6" fill="#C27803" opacity="0.6" />
                          <circle cx="80" cy="10" r="12" fill="#FCD34D" stroke="#C27803" strokeWidth="2" />
                          <circle cx="80" cy="10" r="6" fill="#C27803" opacity="0.6" />

                          {/* è‡‰å‹ (å€’è›‹å½¢) */}
                          <path d="M 15 40 Q 15 5 50 5 Q 85 5 85 40 L 85 70 Q 85 105 50 105 Q 15 105 15 70 Z" fill="#FCD34D" stroke="#C27803" strokeWidth="2" />
                          
                          {/* çœ¼ç› (ç¬‘çœ¼ - å€’U) */}
                          <path d="M 30 45 Q 38 35 46 45" stroke="#1F2937" strokeWidth="4" fill="none" strokeLinecap="round" />
                          <path d="M 54 45 Q 62 35 70 45" stroke="#1F2937" strokeWidth="4" fill="none" strokeLinecap="round" />

                          {/* å»éƒ¨ç·šæ¢ */}
                          <path d="M 20 60 Q 50 55 80 60" stroke="#C27803" strokeWidth="1" fill="none" opacity="0.3" />

                          {/* é¼»å­ (å¤§é»‘é¼» + é«˜å…‰) */}
                          <path d="M 35 60 Q 50 50 65 60 Q 70 70 50 75 Q 30 70 35 60" fill="#000" />
                          <ellipse cx="45" cy="58" rx="6" ry="3" fill="white" opacity="0.9" transform="rotate(-15 45 58)"/>
                          <path d="M 50 75 L 50 85" stroke="#000" strokeWidth="1.5" />

                          {/* å˜´å·´ (å¤§ç¬‘ - é–‹å£) */}
                          <path d="M 30 85 Q 50 105 70 85 Q 50 85 30 85" fill="#7F1D1D" />
                          <path d="M 40 95 Q 50 90 60 95" fill="#F472B6" /> 
                       </svg>

                       {/* è£å‚™å±¤ */}
                       {eyes && (
                         <div className="absolute top-8 left-1/2 -translate-x-1/2 z-50">
                            {eyes.id === 'goggles' && <div className={`w-32 h-14 ${eyes.color} opacity-80 border-4 border-gray-600 rounded-xl backdrop-blur-sm shadow-md`}></div>}
                            {eyes.id === 'mask_welding' && <div className="w-36 h-40 -mt-12 bg-gray-800 rounded-3xl border-2 border-gray-600 flex items-center justify-center shadow-lg"><div className="w-24 h-12 bg-black border-2 border-yellow-500 rounded"></div></div>}
                            {eyes.id === 'shield_face' && <div className={`w-36 h-40 -mt-10 ${eyes.color} opacity-60 border-t-4 border-gray-500 rounded-3xl backdrop-blur-sm shadow-sm`}></div>}
                         </div>
                       )}
                       {face && (
                         <div className={`absolute bottom-[-10px] left-1/2 -translate-x-1/2 w-28 h-20 ${face.color} rounded-b-[2rem] rounded-t-lg border border-gray-400 z-40 flex items-center justify-center shadow-sm`}>
                            {face.id === 'mask_gas' && <div className="flex gap-2"><div className="w-8 h-8 bg-gray-800 rounded-full border-2 border-gray-500"></div><div className="w-8 h-8 bg-gray-800 rounded-full border-2 border-gray-500"></div></div>}
                            {face.id === 'mask_dust' && <div className="w-12 h-10 bg-white rounded-full border border-gray-200 opacity-50"></div>}
                         </div>
                       )}
                       {head && (
                         <div className={`absolute -top-16 left-1/2 -translate-x-1/2 w-44 h-24 ${head.color} rounded-t-full border-b-4 border-gray-700 shadow-md z-50 flex items-center justify-center`}>
                            <div className="w-32 h-2 bg-black/10 rounded-full mt-14"></div>
                            <div className="absolute top-4 w-full text-center text-[10px] font-bold text-black/30">SAFETY FIRST</div>
                         </div>
                       )}
                    </div>
                  </div>

                  {/* èº«é«” (Purple) */}
                  <div className="relative z-20 -mt-2">
                    <div className={`absolute -left-8 top-6 w-10 h-32 bg-[#FCD34D] rounded-full origin-top transform rotate-12 border-2 border-[#C27803] flex flex-col justify-end items-center z-0 transition-transform ${gameState === 'success' ? '-rotate-[140deg] -translate-x-4' : ''}`}></div>
                    <div className={`absolute -right-8 top-6 w-10 h-32 bg-[#FCD34D] rounded-full origin-top transform -rotate-12 border-2 border-[#C27803] flex flex-col justify-end items-center z-0 transition-transform ${gameState === 'success' ? 'rotate-[140deg] translate-x-4' : ''}`}></div>

                    <div className="w-40 h-44 bg-purple-800 rounded-[2rem] relative z-10 border-2 border-purple-900 overflow-hidden flex items-center justify-center shadow-inner">
                       <div className="w-1 h-full bg-black/20"></div>
                       <div className="absolute top-10 left-10 opacity-40 text-white"><Building2 size={20}/></div>
                       {body && <div className={`absolute inset-0 w-full h-full ${body.color} flex flex-col items-center`}><div className="w-full h-full border-x-8 border-orange-500/50"></div></div>}
                       {bodyOuter && <div className={`absolute inset-0 top-4 mx-2 h-full ${bodyOuter.color} rounded-b-lg border-2 border-white/20 shadow-lg`}><div className="absolute -top-4 left-1/2 -translate-x-1/2 w-20 h-4 bg-inherit border-x-2 border-t-2 border-white/20"></div></div>}
                       {bodyAcc && <div className="absolute inset-0 w-full h-full pointer-events-none"><div className="absolute top-10 left-0 w-full h-3 bg-red-600 shadow-sm"></div><div className="absolute top-0 left-8 w-3 h-full bg-red-600 shadow-sm"></div><div className="absolute top-0 right-8 w-3 h-full bg-red-600 shadow-sm"></div></div>}
                    </div>

                    {hands && (
                      <>
                        <div className={`absolute -left-10 top-32 w-14 h-16 ${hands.color} rounded-xl border-2 border-gray-600 shadow-sm z-20 transform rotate-12 ${gameState === 'success' ? 'top-[-50px] -left-[90px]' : ''}`}></div>
                        <div className={`absolute -right-10 top-32 w-14 h-16 ${hands.color} rounded-xl border-2 border-gray-600 shadow-sm z-20 transform -rotate-12 ${gameState === 'success' ? 'top-[-50px] -right-[90px]' : ''}`}></div>
                      </>
                    )}
                  </div>

                  {/* è…¿éƒ¨ */}
                  <div className="flex gap-1 -mt-4 z-10">
                    <div className="w-16 h-32 bg-slate-800 rounded-b-lg border-2 border-slate-900 relative flex justify-center shadow-lg">
                       {feet ? <div className={`absolute -bottom-2 w-18 h-12 ${feet.color} rounded-lg border-b-4 border-black z-20`}></div> : <div className="absolute -bottom-2 w-18 h-10 bg-black rounded-lg z-20"></div>}
                    </div>
                    <div className="w-16 h-32 bg-slate-800 rounded-b-lg border-2 border-slate-900 relative flex justify-center shadow-lg">
                       {feet ? <div className={`absolute -bottom-2 w-18 h-12 ${feet.color} rounded-lg border-b-4 border-black z-20`}></div> : <div className="absolute -bottom-2 w-18 h-10 bg-black rounded-lg z-20"></div>}
                    </div>
                  </div>
                </div>

                <div className="absolute bottom-4 w-56 h-8 bg-black/20 rounded-[100%] blur-sm z-0"></div>
              </div>
            );
          };

          // --- ä¸»ç•«é¢æ¸²æŸ“ ---
          if (gameState === 'start' || gameState === 'result') {
            return (
              <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4 relative overflow-hidden">
                {/* Decorative Background */}
                <div className="absolute top-0 left-0 w-full h-1/2 bg-gradient-to-br from-benq to-purple-800 rounded-b-[3rem] shadow-2xl z-0"></div>
                <div className="absolute top-10 left-10 w-32 h-32 bg-white/10 rounded-full blur-2xl z-0"></div>
                <div className="absolute top-20 right-10 w-48 h-48 bg-white/10 rounded-full blur-3xl z-0"></div>

                <div className="w-full max-w-md bg-white rounded-3xl shadow-[0_20px_50px_rgba(0,0,0,0.1)] overflow-hidden relative z-10 animate-fade-in">
                    {/* Header Section */}
                    <div className="bg-white p-8 pb-0 text-center">
                        <div className="inline-flex items-center justify-center w-16 h-16 bg-purple-50 text-benq rounded-2xl mb-4 shadow-inner">
                            <Building2 size={32} />
                        </div>
                        <h1 className="text-2xl font-black text-slate-800 tracking-tight mb-1">æ˜åŸºææ–™</h1>
                        <div className="text-benq font-bold text-lg tracking-wider uppercase mb-6">å·¥å®‰é˜²è­·å…·æŒ‘æˆ°</div>
                    </div>

                    {/* Form Section / Result Section */}
                    <div className="p-8 pt-2 space-y-4">
                        {gameState === 'result' ? (
                             <div className="w-full flex-1 overflow-hidden flex flex-col">
                                <div className="bg-slate-50 rounded-xl p-4 mb-4 border border-slate-100 flex justify-between items-center">
                                   <div>
                                     <div className="text-xs text-slate-400">ç¸½å¾—åˆ†</div>
                                     <div className="text-2xl font-black text-benq">{score}</div>
                                   </div>
                                   <div className="text-right">
                                     <div className="text-xs text-slate-400">ç¸½è€—æ™‚</div>
                                     <div className="text-2xl font-black text-orange-500">{totalSeconds}s</div>
                                   </div>
                                </div>

                                <div className="bg-white border border-slate-200 rounded-xl p-4 text-left mb-6 shadow-sm">
                                    <h3 className="font-bold text-slate-700 mb-2 flex items-center gap-2"><User size={16}/> æŒ‘æˆ°è€…è³‡è¨Š</h3>
                                    <div className="text-sm space-y-1">
                                        <div className="flex"><span className="text-slate-400 w-20">å» å€ä»£ç¢¼ï¼š</span> <span className="font-medium">{factoryCode}</span></div>
                                        <div className="flex"><span className="text-slate-400 w-20">éƒ¨é–€ä»£ç¢¼ï¼š</span> <span className="font-medium">{deptCode}</span></div>
                                        <div className="flex"><span className="text-slate-400 w-20">å·¥è™Ÿï¼š</span> <span className="font-medium">{employeeId}</span></div>
                                        <div className="flex"><span className="text-slate-400 w-20">å§“åï¼š</span> <span className="font-medium">{userName}</span></div>
                                    </div>
                                </div>

                                <div className="text-center mb-6">
                                    <p className="text-benq font-bold mb-2 animate-bounce">ğŸ“¸ è«‹æˆªåœ–æ­¤ç•«é¢</p>
                                    <a href="https://forms.gle/4z1WqZMZEVMeXUgMA" target="_blank" className="inline-flex items-center gap-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all active:scale-95 w-full justify-center">
                                        <Upload size={20}/> ä¸Šå‚³æˆç¸¾æˆªåœ–
                                    </a>
                                </div>
                                
                                <button onClick={() => setGameState('start')} className="w-full bg-slate-200 text-slate-600 py-3 rounded-xl font-bold flex justify-center gap-2 items-center active:scale-95 transition-transform"><RotateCcw size={18}/> å›é¦–é </button>
                             </div>
                        ) : (
                            <div className="space-y-4">
                                <div className="relative group">
                                    <div className="absolute left-4 top-3.5 text-slate-400 group-focus-within:text-benq transition-colors">
                                        <MapPin size={20} />
                                    </div>
                                    <input type="text" placeholder="å» å€ä»£ç¢¼" className="w-full pl-12 pr-4 py-3 rounded-xl border-2 border-slate-200 font-bold outline-none focus:border-benq transition-colors bg-slate-50 focus:bg-white" value={factoryCode} onChange={(e) => setFactoryCode(e.target.value)} />
                                </div>
                                <div className="relative group">
                                   <div className="absolute left-4 top-3.5 text-slate-400 group-focus-within:text-benq transition-colors">
                                        <Briefcase size={20} />
                                    </div>
                                    <input type="text" placeholder="éƒ¨é–€ä»£ç¢¼" className="w-full pl-12 pr-4 py-3 rounded-xl border-2 border-slate-200 font-bold outline-none focus:border-benq transition-colors bg-slate-50 focus:bg-white" value={deptCode} onChange={(e) => setDeptCode(e.target.value)} />
                                </div>
                                <div className="relative group">
                                    <div className="absolute left-4 top-3.5 text-slate-400 group-focus-within:text-benq transition-colors">
                                        <UserCheck size={20} />
                                    </div>
                                    <input type="text" placeholder="å·¥è™Ÿ" className="w-full pl-12 pr-4 py-3 rounded-xl border-2 border-slate-200 font-bold outline-none focus:border-benq transition-colors bg-slate-50 focus:bg-white" value={employeeId} onChange={(e) => setEmployeeId(e.target.value)} />
                                </div>
                                <div className="relative group">
                                    <div className="absolute left-4 top-3.5 text-slate-400 group-focus-within:text-benq transition-colors">
                                        <User size={20} />
                                    </div>
                                    <input type="text" placeholder="å§“å" className="w-full pl-12 pr-4 py-3 rounded-xl border-2 border-slate-200 font-bold outline-none focus:border-benq transition-colors bg-slate-50 focus:bg-white" value={userName} onChange={(e) => setUserName(e.target.value)} />
                                </div>

                                <button onClick={startGame} disabled={!factoryCode || !deptCode || !employeeId || !userName} className="w-full bg-benq hover:bg-purple-800 text-white py-4 rounded-2xl font-bold shadow-lg shadow-purple-200 active:scale-95 transition-all flex items-center justify-center gap-2 mt-4 disabled:opacity-50 disabled:cursor-not-allowed">
                                    é–‹å§‹æŒ‘æˆ° <ArrowRight size={20} />
                                </button>
                            </div>
                        )}
                    </div>
                    
                    {/* Footer Decoration */}
                    <div className="h-2 bg-gradient-to-r from-benq to-purple-400 w-full"></div>
                </div>
            </div>
            );
          }

          // --- æ‰‹æ©Ÿç‰ˆä¸»è¦ä½ˆå±€ ---
          return (
            <div className="h-full flex flex-col overflow-hidden bg-slate-50">
                {/* 1. ä¸ŠåŠéƒ¨ (å›ºå®šå€åŸŸ) */}
                <div className="flex-none bg-white shadow-md z-20 flex flex-col">
                    {/* Header: é€²åº¦ & åˆ†æ•¸ */}
                    <div className="flex justify-between items-center px-4 py-2 border-b border-slate-100 bg-white">
                        <div className="flex items-center gap-2">
                            <span className="bg-purple-100 text-purple-700 px-2 py-0.5 rounded text-xs font-bold">Q{round}/{TOTAL_ROUNDS}</span>
                            <div className="font-mono font-bold text-orange-500 flex gap-1 items-center text-xs"><History size={12}/> {totalSeconds}s</div>
                        </div>
                        <div className="font-black text-benq text-lg">{score}</div>
                    </div>

                    {/* Content Row: Question Left, Lion Right */}
                    <div className="flex w-full h-[35vh] border-b border-slate-200">
                        {/* Left: Question Area */}
                        <div className="w-7/12 p-3 bg-slate-50 flex flex-col justify-center border-r border-slate-100">
                             {/* Title & Hint Row */}
                             <div className="flex flex-col gap-2 mb-1">
                                 <h1 className="font-bold text-slate-800 text-base leading-tight">{currentScenario?.title}</h1>
                                 {!hintVisible ? (
                                    <button onClick={showHint} className="self-start flex items-center gap-1 text-[10px] font-bold text-amber-600 bg-amber-100 px-2 py-1 rounded-full border border-amber-200 active:scale-95 whitespace-nowrap"><Lightbulb size={10}/> æç¤º</button>
                                ) : (
                                    <div className="self-start text-[10px] font-bold text-amber-600 bg-amber-50 px-2 py-1 rounded border border-amber-100 animate-fade-in">{currentScenario?.hint}</div>
                                )}
                             </div>
                             <p className="text-sm text-slate-600 leading-snug overflow-y-auto max-h-[100px]">{currentScenario?.description}</p>
                        </div>

                        {/* Right: Character Area */}
                        {/* NOTE: Removed overflow-hidden and increased bottom padding to pb-8 to lift the character up */}
                        <div className="w-5/12 relative bg-gradient-to-b from-white to-slate-100 flex justify-center items-end pb-8">
                             {/* Adjust scale to fit in this 1/2 width container */}
                             <WorkerFigure className="scale-[0.42] sm:scale-75 -translate-y-8" />
                        </div>
                    </div>
                </div>

                {/* 2. ä¸‹åŠéƒ¨ (æ»¾å‹•å€åŸŸ)ï¼šè£å‚™åˆ—è¡¨ */}
                <div className="flex-1 overflow-y-auto bg-slate-100 p-2 pb-24 custom-scrollbar">
                    <div className="grid grid-cols-4 gap-2">
                        {EQUIPMENT_LIST.map((item) => {
                            const isWorn = wornItems.find(i => i.id === item.id);
                            const Icon = item.Component;
                            return (
                                <button key={item.id} onClick={() => toggleItem(item)} disabled={gameState !== 'playing'}
                                    className={`relative flex flex-col items-center p-1 rounded-xl border-2 transition-all active:scale-95
                                    ${isWorn ? 'bg-purple-50 border-benq shadow-sm' : 'bg-white border-slate-200'}`}
                                >
                                    {isWorn && <div className="absolute top-1 right-1 text-benq"><CheckCircle size={14}/></div>}
                                    <div className="w-6 h-6 mb-1"><Icon /></div>
                                    <div className="text-xs font-bold text-slate-600 text-center leading-tight truncate w-full">{item.name}</div>
                                </button>
                            )
                        })}
                    </div>
                </div>

                {/* 3. åº•éƒ¨æµ®å‹•æŒ‰éˆ• */}
                <div className="fixed bottom-0 left-0 w-full bg-white px-4 py-3 border-t border-slate-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-30">
                    <div className="max-w-md mx-auto flex gap-2">
                        <button onClick={() => setWornItems([])} className="p-3 rounded-xl bg-slate-100 text-slate-500 border border-slate-300 active:scale-95"><RotateCcw size={18}/></button>
                        {gameState === 'playing' ? (
                            <button onClick={checkAnswer} className="flex-1 bg-benq hover:bg-benq-dark text-white font-bold rounded-xl py-3 shadow-lg shadow-purple-200 active:scale-95 transition-transform flex justify-center items-center gap-2 text-sm">
                                ç¢ºèªè£å‚™ <CheckCircle size={16}/>
                            </button>
                        ) : (
                            <button onClick={nextRound} className="flex-1 bg-blue-600 text-white font-bold rounded-xl py-3 shadow-lg shadow-blue-200 active:scale-95 transition-transform flex justify-center items-center gap-2 text-sm">
                                {round >= TOTAL_ROUNDS ? 'æŸ¥çœ‹çµæœ' : 'ä¸‹ä¸€é¡Œ'} <ArrowRight size={16}/>
                            </button>
                        )}
                    </div>
                </div>

                {/* çµæœå½ˆçª— (Overlay) */}
                {message && gameState !== 'playing' && gameState !== 'leaderboard' && gameState !== 'result' && (
                    <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white/95 backdrop-blur shadow-2xl border-2 border-slate-100 rounded-2xl p-6 w-4/5 text-center z-50 animate-fade-in">
                        <div className={`text-xl font-black mb-2 ${gameState === 'success' ? 'text-green-500' : 'text-red-500'}`}>
                            {gameState === 'success' ? 'ç­”å°äº†ï¼' : 'å“å‘€...'}
                        </div>
                        <p className="text-sm text-slate-600 font-bold mb-4">{message}</p>
                        
                        {/* é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆå€åŸŸ */}
                        {failDetails && (
                            <div className="bg-red-50 rounded-xl p-3 text-left border border-red-100 text-xs">
                                {failDetails.type === 'incorrect' && failDetails.missing && failDetails.missing.length > 0 && (
                                    <div className="mb-2">
                                        <div className="font-bold text-red-500 flex items-center gap-1 mb-1"><AlertTriangle size={12}/> ç¼ºå°‘è£å‚™ï¼š</div>
                                        <div className="text-slate-700 pl-4">{failDetails.missing.join('ã€')}</div>
                                    </div>
                                )}
                                {failDetails.type === 'forbidden' && (
                                    <div className="mb-2 text-red-600 font-bold">
                                        {failDetails.text}
                                    </div>
                                )}
                                <div className="mt-2 pt-2 border-t border-red-200">
                                    <div className="font-bold text-emerald-600 flex items-center gap-1 mb-1"><CheckCircle size={12}/> æ­£ç¢ºé…ç½®ï¼š</div>
                                    <div className="text-slate-700 pl-4">{failDetails.correctList.join('ã€')}</div>
                                </div>
                            </div>
                        )}
                    </div>
                )}
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SafetyGearGame />);
    </script>
</body>
</html>
